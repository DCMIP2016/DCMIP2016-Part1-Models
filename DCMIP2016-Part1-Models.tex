%% Copernicus Publications Manuscript Preparation Template for LaTeX Submissions
%% ---------------------------------
%% This template should be used for copernicus.cls
%% The class file and some style files are bundled in the Copernicus Latex Package which can be downloaded from the different journal webpages.
%% For further assistance please contact the Copernicus Publications at: publications@copernicus.org
%% http://publications.copernicus.org


%% Please use the following documentclass and Journal Abbreviations for Discussion Papers and Final Revised Papers.


%% 2-Column Papers and Discussion Papers
\documentclass[gmd, manuscript]{copernicus}



%% Journal Abbreviations (Please use the same for Discussion Papers and Final Revised Papers)

% Archives Animal Breeding (aab)
% Atmospheric Chemistry and Physics (acp)
% Advances in Geosciences (adgeo)
% Advances in Statistical Climatology, Meteorology and Oceanography (ascmo)
% Annales Geophysicae (angeo)
% ASTRA Proceedings (ap)
% Atmospheric Measurement Techniques (amt)
% Advances in Radio Science (ars)
% Advances in Science and Research (asr)
% Biogeosciences (bg)
% Climate of the Past (cp)
% Drinking Water Engineering and Science (dwes)
% Earth System Dynamics (esd)
% Earth Surface Dynamics (esurf)
% Earth System Science Data (essd)
% Fossil Record (fr)
% Geographica Helvetica (gh)
% Geoscientific Instrumentation, Methods and Data Systems (gi)
% Geoscientific Model Development (gmd)
% Geothermal Energy Science (gtes)
% Hydrology and Earth System Sciences (hess)
% History of Geo- and Space Sciences (hgss)
% Journal of Sensors and Sensor Systems (jsss)
% Mechanical Sciences (ms)
% Natural Hazards and Earth System Sciences (nhess)
% Nonlinear Processes in Geophysics (npg)
% Ocean Science (os)
% Proceedings of the International Association of Hydrological Sciences (piahs)
% Primate Biology (pb)
% Scientific Drilling (sd)
% SOIL (soil)
% Solid Earth (se)
% The Cryosphere (tc)
% Web Ecology (we)
% Wind Energy Science (wes)


%% \usepackage commands included in the copernicus.cls:
%\usepackage[german, english]{babel}
%\usepackage{tabularx}
%\usepackage{cancel}
%\usepackage{multirow}
%\usepackage{supertabular}
%\usepackage{algorithmic}
%\usepackage{algorithm}
%\usepackage{amsthm}
%\usepackage{float}
%\usepackage{subfig}
%\usepackage{rotating}

\usepackage{subcaption}

% Custom commands
\newcommand{\vb}{\mathbf}
\newcommand{\vg}{\boldsymbol}
\newcommand{\mat}{\mathsf}
\newcommand{\diff}[2]{\frac{d #1}{d #2}}
\newcommand{\diffsq}[2]{\frac{d^2 #1}{{d #2}^2}}
\newcommand{\pdiff}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pdiffsq}[2]{\frac{\partial^2 #1}{{\partial #2}^2}}

% User-defined mathematical symbols
\renewcommand{\emph}[1]{{\color{red}\textbf{#1}}}
\newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\p}[1]{\partial #1}
%Then, writing a partial is as simple as $\pd{J}{x}$.
\newcommand{\ol}[1]{{\overline #1}}
\newcommand{\mbf}[1]{{\mathbf #1}}
\newcommand{\mbfol}[1]{\overline{{\mathbf #1}}}
\newcommand{\wdh}[1]{{\widehat #1}}
\newcommand{\wdt}[1]{{\widetilde #1}}
\newcommand{\sss}[1]{{\scriptscriptstyle #1}}
\newcommand{\scs}[1]{{\scriptstyle #1}}


\begin{document}

\title{DCMIP2016:  A Review of Nonhydrostatic Dynamical Core Design and Intercomparison of Participating Models}


% \Author[affil]{given_name}{surname}

\Author[1]{Paul A.}{Ullrich}
\Author[2]{Christiane}{Jablonowski}
\Author[3]{James}{Kent}
\Author[4]{Peter H.}{Lauritzen}
\Author[4]{Ramachandran}{Nair}
\Author[5]{Kevin A.}{Reed}
\Author[4]{Colin M.}{Zarzycki}

\Author[6]{Don}{Dazlich}
\Author[6]{Ross}{Heikes}
\Author[6]{Celal}{Konor}
\Author[6]{David}{Randall}

\Author[7]{Thomas}{Dubos}
\Author[7]{Yann}{Meurdesoif}

\Author[8]{Xi}{Chen}
\Author[8]{Lucas}{Harris}

\Author[9]{Christian}{K\"uhnlein}

\Author[10]{Vivian}{Lee}
\Author[10]{Abdessamad}{Qaddouri}
\Author[10]{Claude}{Girard}

\Author[11]{David M.}{Hall}

\Author[12]{Marco}{Giorgetta}
\Author[13]{Daniel}{Reinert}

\Author[4]{Joseph}{Klemp}
\Author[4]{Sang-Hun}{Park}
\Author[4]{William}{Skamarock}

\Author[14]{Hiroaki}{Miura}
\Author[14]{Tomoki}{Ohno}
\Author[15]{Ryuji}{Yoshida}

\Author[16]{Robert}{Walko}

\Author[17]{Alex}{Reinecke}
\Author[17]{Kevin}{Viner}

%\Author[18]{Elijah}{Goodfriend}
%\Author[18]{Hans}{Johansen}

\affil[1]{University of California, Davis}
\affil[2]{University of Michigan}
\affil[3]{University of South Wales}
\affil[4]{National Center for Atmospheric Research}
\affil[5]{Stony Brook University}
\affil[6]{Colorado State University}
\affil[7]{Institut Pierre-Simon Laplace (IPSL)}
\affil[8]{Geophysical Fluid Dynamics Laboratory (GFDL)}
\affil[9]{European Centre for Medium-Range Weather Forecasts (ECMWF)}
\affil[10]{Environment and Climate Change Canada}
\affil[11]{University of Colorado, Boulder}
\affil[12]{Max Planck Institute for Meteorology}
\affil[13]{Deutscher Wetterdienst (DWD)}
\affil[14]{University of Tokyo}
\affil[15]{RIKEN}
\affil[16]{University of Miami}
\affil[17]{Naval Research Laboratory}

%% The [] brackets identify the author with the corresponding affiliation. 1, 2, 3, etc. should be inserted.



\runningtitle{DCMIP2016: A Review of Nonhydrostatic Dynamical Core Design and Intercomparison}

\runningauthor{Ullrich, et al.}

\correspondence{Paul A. Ullrich (paullrich@ucdavis.edu)}



\received{}
\pubdiscuss{} %% only important for two-stage journals
\revised{}
\accepted{}
\published{}

%% These dates will be inserted by Copernicus Publications during the typesetting process.


\firstpage{1}

\maketitle



\begin{abstract}
Atmospheric dynamical cores are a fundamental component of global atmospheric modeling systems, and are responsible for capturing the dynamical behavior of the Earth's atmosphere via numerical integration of the Navi\'er-Stokes equations.  These systems have existed in one form or another for over half of a century, with the earliest discretizations having now evolved into a complex ecosystem of algorithms and computational strategies.  In essence, no two dynamical cores are alike, and their individual successes suggest that no perfect model exists.  To better understand modern dynamical cores, this paper aims to provide a comprehensive review of eleven dynamical cores, drawn from modeling centers and groups that participated in the 2016 Dynamical Core Model Intercomparison Project (DCMIP) workshop and summer school.  This review includes choice of model grid, variable placement, vertical coordinate choices, prognostic equations, temporal discretization, and the diffusion, stabilization, filters and fixers employed by each system.
\end{abstract}



\introduction  %% \introduction[modified heading if necessary]

The Dynamical Core Model Intercomparison Project (DCMIP) is an ongoing effort targeting the intercomparison of a fundamental component of global atmospheric modeling systems: the dynamical core.  Although this component's role is simply to solve the equations of fluid motion (the Navi\'er-Stokes equations) governing atmospheric dynamics, there are numerous confounding factors and compromises that arise from making global simulations computationally feasible.  These factors include the choice of model grid, variable placement, prognostic equations, vertical coordinates, representation of topography, numerical method, temporal discretization, physics/dynamics coupling frequency, and the manner in which artificial diffusion, stabilization, filters and/or energy/mass fixers are applied.

To advance the intercomparison project and provide a unique educational opportunity for students, DCMIP hosted a multidisciplinary two-week summer school and model intercomparison project, held at the National Center for Atmospheric Research (NCAR) in June 2016, that invited graduate students, postdocs, atmospheric modelers, expert lecturers and computer specialists to create a stimulating, unique and hands-on driven learning environment. The 2016 workshop and summer school followed from earlier DCMIP and dynamical core workshops (held in 2012 and 2008, respectively), and other model intercomparison efforts.  Its goals were to provide a forum for discussing outstanding issues in global atmospheric models, incorporate international participation, and provide a unique training experience for the future generation of climate scientists. Special attention was paid to the role of simplified physical parameterizations, physics-dynamics coupling, non-hydrostatic atmospheric modeling, and variable-resolution global modeling. The summer school and model intercomparison project promoted active learning, innovation, discovery, mentorship and the integration of science and education.  Modeling groups were then invited to contribute model descriptions and results to the intercomparison effort for publication.

The summer school directly benefited its participants by providing a unique educational experience and an opportunity to interact with modeling teams from around the world.  The workshop is expected to have further repercussions on the development of operational atmospheric modeling systems, by giving modeling groups an opportunity to assess and intercompare their models with other advanced modeling systems.  Past and present intercomparison efforts have been leveraged by modeling groups to improve their own models, in turn leading to a positive impact on the quality of weather and climate simulations.  The workshop component of DCMIP has also advanced our knowledge of (1) the relative behaviors exhibited by atmospheric dynamical cores, (2) differences that arise among mechanisms for coupling the physical parameterizations and dynamical core, and (3) the impacts of variable-resolution refinement regions and transition zones in global atmospheric simulations.  Notably, the use of idealized test cases to isolate specific phenomena gave us a unique opportunity to assess specific differences that arise due to the choice of dynamical core.  Another important outcome of the workshop was the development of a standard test case suite and benchmark set of simulations that can be used for assessment of any future dynamical core.  The test cases introduced in the 2016 workshop build on the previous DCMIP test case suites \citep{jablonowski2008idealized, ullrich2012dynamical} with tests that now incorporate simplified moist physics.

This paper is the first in a series of papers documenting the results of this workshop.  Its purposes is twofold:  First, to review the multitude of technologies and techniques that have been developed for non-hydrostatic global atmospheric modeling; and second, to provide a mechanism to understand the differences that arise in the test cases of later papers in this series.  For easy reference, a list of mathematical symbols that are employed in this paper (and subsequent DCMIP papers) is given in Table \ref{tab:symbols}.  Section \ref{sec:DynamicalCores} then provides a brief overview of each of the participating models, along with a tabulation of relevant details about the dynamical core design.  The body of this paper is dedicated to an overview of techniques available for building the infrastructure of a global dynamical core:  Section \ref{sec:ModelGrids} describes model grids that have been employed by modern modeling systems; section \ref{sec:VariablePlacement} describes aspects of variable placement and prognosis; section \ref{sec:DiffusionStabilization} describes diffusion, stabilization, filters and fixers employed by these models; and section \ref{sec:TemporalDiscretizations} describes temporal discretizations.  The summary and conclusions then follow in section \ref{sec:Conclusions}.  Finally, appendix \ref{sec:EquationSets} provides a comprehensive overview of the various forms the Navi\'er-Stokes equations take in dynamical cores, and has been included as a resource for dynamical core developers.

\begin{table}[p]
\caption{A standard list of symbols used throughout this paper and in the DCMIP.} \label{tab:symbols}
\begin{center}
\begin{tabular}{cl}
\hline Symbol & Description \\ \hline 
$\lambda$ & Longitude (in radians) \\
$\varphi$ & Latitude (in radians) \\
$z$ & Height with respect to mean sea level (set to zero) \\
$s$ & Vertical model coordinate \\
$p_s$ & Surface pressure ($p_s$ of moist air if $q>0$) \\
$\Phi_s$ & Surface geopotential \\
$z_s$ & Surface elevation with respect to mean sea level (set to zero) \\
$u$ & Zonal wind velocity \\
$v$ & Meridional wind velocity \\
$w$ & Vertical wind velocity \\
$\vb{u}$ & 3D wind vector \\
$\vb{u}_h$ & Horizontal wind vector \\
$\vb{v}_h$ & Horizontal wind vector with covariant components \\
$\omega$ & Vertical pressure velocity  \\
$D$ & Divergence of the horizontal wind vector\\
$\zeta$ & Vertical component of relative vorticity\\
$p$ & Pressure (pressure of moist air if $q>0$) \\
$e$ & Internal energy \\
$\rho$ & Total air density \\
$\rho_d$ & Dry air density \\
$\rho_s$ & Pseudo-density \\
$T$ &Temperature \\
$T_v$ & Virtual temperature \\
$\theta$ & Potential temperature \\
$\theta_v$ & Virtual potential temperature \\
$\theta_{il}$ & Ice-liquid potential temperature \\
%$P_{ls}$ & Large-scale precipitation rate \\
$q$ & Water vapor mixing ratio \\
$q_c$ & Cloud water mixing ratio \\
$q_r$ & Rain water mixing ratio \\
$q_i$ & General tracer mixing ratio \\
\hline 
\end{tabular}
\end{center}
\end{table}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Dynamical Cores} \label{sec:DynamicalCores}

This section provide a brief overview of key discretization choices, along with unique features or design specifications from participating dynamical cores.  Further details on these choices can be found in subsequent sections.  Simulation results and model descriptions have been submitted from eleven dynamical cores (see Table \ref{tab:Models}).  Although all models solve the Euler equations (or a close approximation of these equations), essentially every model employs a different formulation with a distinct set of prognostic variables.  The derivation of many of these formulations can be found in Appendix \ref{sec:EquationSets}.  The prognostic variables employed and horizontal discretizations for these dynamical cores are summarized in Table \ref{tab:ModelsHorizontal}.  The vertical staggering of variables and vertical coordinate choice is summarized in Table \ref{tab:ModelsVertical}.  Standard options for diffusion, stabilization, filters, or fixers along with the temporal discretization for these models is summarized in Table \ref{tab:ModelsTemporalDiffusion}.  The participant models are briefly described through the remainder of this section.

\begin{table}[p]
\caption{Participating modeling centers and associated dynamical cores that have submitted simulation results.} \label{tab:Models}
\begin{center}
\begin{tabular}{cll}
\hline Acronym & Model Name & Modeling Center or Group \\ \hline 
CSU & Colorado State University Model & Colorado State University, USA \\
DYNAMICO & DYNAMICO & Institut Pierre Simon Laplace (IPSL), France \\
FV$^3$ & GFDL Finite-Volume Cubed-Sphere Dynamical Core & Geophysical Fluid Dynamics Laboratory, USA \\
FVM & Finite Volume Module of the Integrated Forecasting System & European Centre for Medium-Range Weather Forecasts \\
GEM & Global Environmental Multiscale model & Environment and Climate Change Canada \\
HOMME & High-Order Method Modeling Environment & Sandia National Laboratories / University of Colorado, Boulder \\
ICON & Icosahedral Non-hydrostatic model & Max-Planck-Institut f\"ur Meteorologie, Germany \\
MPAS & Model for Prediction Across Scales & National Center for Atmospheric Research, USA \\
NICAM & Non-hydrostatic Icosahedral Atmospheric Model & AORI / JAMSTEC / AICS, Japan \\
OLAM & Ocean Land Atmosphere Model & Duke University / University of Miami, USA \\
Tempest & Tempest Non-hydrostatic Atmospheric Model & University of California, Davis, USA \\
\hline 
\end{tabular}
\end{center}
\end{table}


\begin{table}[p]
\caption{Details on the prognostic variables and horizontal discretization for participating dynamical cores.  Equation set indicates whether a model is hydrostatic (H) or non-hydrostatic (NH), and whether the model presently supports the deep-atmosphere formulation (D).  Only three numerical methods are represented among participating models, namely finite-difference (FD), finite-volume (FV), and spectral-element (SE).  More details on horizontal staggering can be found in section \ref{sec:HorizontalStaggering}.} \label{tab:ModelsHorizontal}
\begin{center}
\begin{tabular}{cccccc}
\hline Acronym & Equation set & Prognostic Variables & Horizontal Grid & Numerical & Horizontal  \\
& & & & method & staggering \\ \hline
CSU & NH (Unified) & $\zeta$, $D$, $w$, $p_s$, $\theta_v$, $q$ & Geodesic (\S \ref{sec:grid_geo}) & FV & Z-grid \\
DYNAMICO & H/NH & $\vb{v}_h$, $\rho_s w$, $\rho_s$, $\rho_s \theta_v$, $\Phi$, $\rho_s q$ & Geodesic (\S \ref{sec:grid_geo}) & FV & C-grid \\
FV$^3$ & NH & $\vb{u}_h$, $w$, $\rho_s$, $\rho_s \theta_v$, $\delta \Phi$, $\rho_s q$ & Cubed-sphere (\S \ref{sec:grid_cs}) & FV & D-grid \\
FVM & NH (D) & $\rho_d$, $\vb{u}_h$, $w$, $\theta'$, $q$ & Octahedral reduced (\S \ref{sec:grid_oct}) & FV & A-grid \\
GEM & NH & $\vb{u}_h$, $w$, $\dot{\zeta}$, $T_v$, $p$, $q$ & Yin-Yang (\S \ref{sec:grid_yinyang}) & FD & C-grid  \\
HOMME & H & $\vb{u}_h$, $\rho_s$, $T_v$, $\rho_s q$ & Cubed-sphere (\S \ref{sec:grid_cs}) & SE & A-grid \\
ICON & NH & $\vb{u}_h$, $w$, $\rho$, $\theta_v$, $\rho q$ & Icosahedral triangular (\S \ref{sec:grid_ico_tri}) & FV & C-grid \\
MPAS & NH & $\rho_d \vb{u}_h$, $\rho_d w$, $\rho_d$, $\rho_d \theta_v$, $\rho_d q$ & CCVT (\S \ref{sec:grid_ccvt}) & FV & C-grid \\
NICAM & NH & $\rho \vb{u}_h$, $\rho w$, $\rho$, $\rho e$, $\rho q$ & Geodesic (\S \ref{sec:grid_geo}) & FV & A-grid \\
OLAM & NH (D) & $\rho \vb{u}_h$, $\rho w$, $\rho$, $\rho \theta_{il}$, $\rho q$ & Geodesic (\S \ref{sec:grid_geo}) & FV & C-grid \\
Tempest & NH & $\vb{u}_h$, $w$, $\rho$, $\rho \theta_v$, $\rho q$ & Cubed-sphere (\S \ref{sec:grid_cs}) & SE & A-grid \\
\hline 
\end{tabular}
\end{center}
\end{table}

\begin{table}[p]
\caption{Vertical staggering (detailed in section \ref{sec:VerticalStaggering}) and vertical coordinates (detailed in section \ref{sec:VerticalCoordinates}) for participating dynamical cores.} \label{tab:ModelsVertical}
\begin{center}
\begin{tabular}{cccccc}
\hline Acronym & Vertical Staggering & Vertical Coordinate \\ \hline 
CSU & Lorenz & fixed height \\
DYNAMICO & Lorenz & floating mass (\S \ref{sec:FloatingLagrangian}) \\
FV$^3$ & Co-located & floating mass (\S \ref{sec:FloatingLagrangian}) \\
FVM & Co-located & fixed height \\
GEM & Modified Charney-Phillips (\S \ref{sec:VerticalStaggering}) & log pressure (\S \ref{sec:GEM_zeta})  \\
HOMME & Co-located & floating mass (\S \ref{sec:FloatingLagrangian}) \\
ICON & Lorenz & fixed height \\
MPAS & Lorenz & fixed height \\
NICAM & Lorenz & fixed height \\
OLAM & Lorenz & fixed height with cut-cells (\S \ref{sec:CutCells}) \\
Tempest & Lorenz & fixed height \\
\hline 
\end{tabular}
\end{center}
\end{table}

\begin{table}[p]
\caption{Standard options for diffusion, stabilization, filters, or fixers in participating dynamical cores (detailed in section \ref{sec:DiffusionStabilization}) and temporal discretization (detailed in section \ref{sec:TemporalDiscretizations}).} \label{tab:ModelsTemporalDiffusion}
\begin{center}
\begin{tabular}{cccccc}
\hline Acronym & Standard options for diffusion, & Temporal discretization \\
& stabilization, filters, or fixers & \\ \hline 
CSU & 4th-order horizontal hyperviscosity & 3rd-order Adams-Bashforth (AB3) \\
DYNAMICO & 4th-order horizontal hyperviscosity & ARK232 \citep{giraldo2013implicit} \\
FV$^3$ & Divergence damping, hyperviscosity & Forward-backwards \citep{LR1997QJR} / semi-implicit \\
FVM & Monotonic limiting & Semi-implicit \citep{smolarkiewiczJCP2014} (\S \ref{sec:FVMSemiImplicit}) \\
GEM & Hyperviscosity & Semi-implicit \citep{Girard2014} (\S \ref{sec:GEM_temporal}) \\
HOMME & 4th-order horizontal hyperviscosity & KGU53 \citep{guerra2016high} \\
ICON & Divergence damping, Smagorinsky, hyperdiffusion & Predictor-corrector \\
MPAS & Smagorinsky, hyperdiffusion & Split-explicit \citep{klemp2007conservative} \\
NICAM & 3D divergence damping, Smagorinsky, hyperviscosity & Split-explicit \citep{klemp2007conservative} \\
OLAM & Divergence/vorticity damping & 2nd-order Adams-Bashforth, Lax-Wendroff (for tracers) \\
Tempest & 4th-order horizontal hyperviscosity & ARS232 \citep{ascher1997implicit} \\
\hline 
\end{tabular}
\end{center}
\end{table}

%Do not include information on the physical parameterizations used by the modeling system.  Make reference to the model grid employed from section \ref{sec:ModelGrids}, the specific equation set being discretized by the model in section \ref{sec:EquationSets}, explicit numerical techniques for diffusion and stabilization in section \ref{sec:DiffusionStabilization}, filters and fixers in section \ref{sec:FiltersFixers} and the temporal discretization in section \ref{sec:TemporalDiscretizations}.}

\subsection{Colorado State University Model (CSU)}
  
The CSU model uses an optimized geodesic grid to discretize the sphere \citep{heikes1995numerical,heikes2013optimized}, with height as the vertical coordinate. The model is based on the non-hydrostatic Unified System of equations proposed by \cite{arakawa2009unification}, which filters vertically propagating sound waves but allows the Lamb wave and does not require a reference state. The horizontal wind field is determined by predicting the vertical component of the vorticity and the divergence of the horizontal wind, and then solving a pair of two-dimensional Poisson equations for a stream function and velocity potential. Horizontal diffusion is included in the form of a fourth-order Laplacian operator applied on constant height surfaces ($\nabla^4_z$) that acts on the vorticity, divergence, potential temperature, and tracer.  The CSU model supports both third-order and fifth-order upstream-weighted finite-volume advection schemes, with positivity preservation enforced via mass borrowing.
\subsection{DYNAMICO}

DYNAMICO is a mimetic finite-difference / finite-volume model, solving initially the hydrostatic primitive equations and recently extended to solve the shallow-atmosphere fully-compressible equations. DYNAMICO's design uniquely combines a representation of the prognostic and diagnostic fields following the ideas of discrete differential geometry, \citep{Dubos2015DYNAMICO10}.  It includes a novel Hamiltonian formulation of the equations of motion in non-Eulerian coordinates \citep{Dubos2014Equations} which is imitated at the discrete level using building blocks from the literature \citep{thuburn2009numerical,ringler2010unified}, and (up to the addition of explicit diffusion) leads to an energy-conserving spatial discretization.  It also incorporates a novel explicit-implicit splitting which results in a simple, efficient and scalable implicit solver while allowing stable time steps close or identical to those of the hydrostatic solver (Dubos and Dubey, in preparation).  In addition, it features a conservative positive-definite transport scheme based on a slope-limited finite-volume approach \citep{Dubey2015Intercomparison}.

\subsection{FV Cubed (FV$^3$)}

The GFDL Finite-Volume Cubed-Sphere Dynamical Core (FV$^3$, or sometimes written FV3) is a fully finite-volume discretization of the fully-compressible non-hydrostatic Euler equations on the equiangular gnomonic cubed-sphere grid with flow-following Lagrangian vertical coordinate \citep{lin2004vertically}. The Lagrangian vertical coordinate deforms so that the flow is constrained to follow the Lagrangian surfaces, allowing vertical transport to be represented implicitly without additional advection terms (see section \ref{sec:FloatingLagrangian} below). Fluxes are computed using the Piecewise-Parabolic Method of \citet{CW1984JCP} with an optional monotonicity constraint; in non-hydrostatic applications the monotonicity constraint is used primarily for tracer transport. The discretization is on the C-D grid as described by \citet{LR1997QJR} (see section \ref{sec:CDGrid}). Since divergence is effectively invisible to the solver, a divergence damping is applied to control numerical noise as divergent modes cascade to the grid scale.  Implicit viscosity is applied through the monotonicity constraint; if non-monotonic advection is used for the momentum and total air mass a weak explicit hyperviscosity is applied for stability and to alleviate numerical noise. Explicit viscosity is applied every acoustic timestep. 

The prognostic horizontal winds are stored in the native Gnomonic local coordinate. The non-hydrostatic solver adds a prognostic vertical velocity and geometric height of each grid cell, which can then be used to compute density. All variables are 3D cell-mean values, except for the horizontal winds, which are 2D face-mean values on their respective staggerings; as a result, diagnostic vorticity is a 3D cell-mean value.

\subsection{Finite-Volume Module (FVM) of the Integrated Forecasting System}
\label{sec:FVM}

The finite-volume module (FVM) of the Integrated Forecasting System (IFS) is presently under development at 
ECMWF \citep{smolarkiewiczetalJCP2016}. FVM solves the fully compressible Euler 
equations in geospherical coordinates. Both deep-atmosphere and shallow-atmosphere equations 
are available by means of simple switches. The formulation incorporates 
a generalized, optionally time-dependent, terrain-following vertical coordinate based on height. 
A centered two-time-level semi-implicit integration scheme is employed with 3D implicit treatment 
of acoustic, buoyant, and rotational modes \citep{smolarkiewiczJCP2014} (see section \ref{sec:FVMSemiImplicit}). The associated 3D 
Helmholtz problem is solved iteratively using a bespoke preconditioned Generalised 
Conjugate Residual approach. The dynamics time step is adapted 
at every time step according to a given maximum advective CFL number (typically somewhat smaller 
than 1). The physics time step is identical to the dynamics time step. 
 
The integration procedure uses the multidimensional flux-form Eulerian non-oscillatory MPDATA 
advection scheme \citep{smolarkiewiczszmelter2005,kuehnleinJCP2017}. 
The horizontal spatial discretization is fully unstructured finite-volume using the 
median-dual approach. This is combined with a structured-grid finite-difference approach in the 
vertical direction; see \cite{smolarkiewiczetalJCP2016} for an exposition. 
In both the horizontal and the vertical discretization, all prognostic variables are 
co-located. The median-dual finite-volume mesh in the horizontal is developed about the points/nodes 
of the octahedral reduced Gaussian grid (see section \ref{sec:grid_oct}). The octahedral 
reduced Gaussian grid is also employed in the spectral dynamical core of the current operational 
IFS at ECMWF, which facilitates interoperability of the two formulations. However, we note that FVM is 
not restricted to this grid and offers capabilities towards a broad classes of meshes including adaptivity. 

No explicit diffusion is applied in FVM for DCMIP, apart from the momentum dissipation and scalar 
diffusion required for some of the test cases, which is the vertical dissipation/diffusion in the planetary
boundary layer parametrization and the constant-coefficient second-order dissipation/diffusion in 
the supercell test. An absorbing layer in the first latitude ring around the poles is optionally used in 
the form of a Rayleigh-type forcing to the prognostic variables. 

%The first row of the table below refers to the size of the octahedral reduced Gaussian grid, where 
%the number following "O" (for octahedral) denotes the number of latitudes between pole and equator.


%Neither explicit diffusion/filters nor decentering of the time-stepping scheme is applied in DCMIP, 
%No explicit diffusion is applied in FVM in DCMIP, apart from the explicit momentum dissipation and 
%scalar diffusion required for some of the test cases.  FVM uses adaptive time stepping for optimal
%efficiency and accuracy. 
 
%FVM employs distributed- and shared-memory parallelisation using the MPI and OpenMP standards, 
%respectively. %The underlying distributed-memory data structures in FVM are provided by the Atlas 
%framework developed at ECMWF. 


\subsection{Global Environmental Multiscale (GEM) Model} \label{sec:GEM_core}

The GEM model \citep{Girard2014} is used for operational forecasting at Environment and Climate Change Canada.  The horizontal discretization uses the Yin-Yang grid \citep{kageama2004yinyang} with Arakawa C-grid staggering.
The vertical coordinate is a unique hybrid terrain-following coordinate of a log-hydrostatic-pressure type
and the vertical discretization is based on the Charney-Phillips grid (see section \ref{sec:VerticalStaggering}).
A two time level semi-Lagrangian implicit time discretization is implemented as described in section \ref{sec:GEM_temporal}.
It gives rise to an {\it{iterative}} process where each step requires the solution of a
linear system of equations that is reduced to a Helmholtz problem for one composite variable.
For this problem, a direct solver is involved, using the Schwarz-type domain decomposition method \citep{Qaddouri2008schwarz}.
The dynamics and physics are time split.
To eliminate numerical noise, an explicit hyperviscosity is employed for wind components and tracers
via applications of the Laplacian operator.
Viscosity operations are applied after the completion of the physics time step.

\subsection{High-Order Method Modeling Environment (HOMME)}

The High Order Method Modeling Environment (HOMME) \citep{taylor2010compatible, dennis2012cam} is currently used by both the Community Atmosphere Model Spectral Element (CAM-SE) dynamical core and Accelerated Climate Model for Energy Atmosphere (ACME-A) dynamical core.  As a general framework for several dynamical methods, HOMME includes a hydrostatic option and an experimental non-hydrostatic core, although only shallow-atmosphere mode is available at present. The model is designed to be mass and energy conserving, with nearly optimal parallel scalability at large core counts. The CAM-SE dynamical core is a hydrostatic model that partitions the globe horizontally using an unstructured grid of quadrilateral elements. These elements are arranged in a cubed-sphere structure, although arbitrary quadrilateral grids with conforming edges may also be employed.  The model employs a hybrid terrain-following pressure coordinate in the vertical. The fluid equations are discretized using dimension splitting, with a nodal 4th-order spectral element discretization in the horizontal and the mimetic (mass and energy conserving) 2nd order finite difference discretization of \cite{simmons1981energy} in the vertical. Fields are co-located in the horizontal in the sense that they share the same 4th-order basis functions. Lorenz staggering is employed in the vertical with (u,v,T$_v$,p) placed on layer midpoints and diagnostic vertical fluxes $m \dot \eta$ are computed on layer interfaces.


%A conventional vector-invariant form for the moist primitive equations is employed with prognostic zonal and meridional wind components $u,v$, temperature $T$, surface pressure $p_s$, and tracer mixing ratios $q_i$. The PDEs are discretized using a split approximation, with a nodal 4th-order spectral element discretization in the horizontal and the mimetic (mass and energy conserving) 2nd order finite difference discretization of \cite{simmons1981energy} in the vertical. Fields are co-located in the horizontal in the sense that they share the same 4th-order basis functions. Lorenz staggering is employed in the vertical with (u,v,T,p) placed on layer midpoints while vertical fluxes $m \dot \eta$ are placed on layer interfaces.


\subsection{Icosahedral Non-hydrostatic model (ICON)}

The ICON model \citep{zangl2014icon} discretizes the compressible equations for a shallow atmosphere in vector invariant form for the horizontal wind on a triangular Arakawa C-grid and a smoothed terrain-following height-based Lorenz grid.  Prognostic horizontal velocities are stored as normal wind components $v_n$ at the edge mid-points of full levels.  Prognostic vertical wind $w$ is stored at the circumcenters of the triangles on half levels. The discretization in time employs a two time level predictor corrector scheme, which is explicit in all terms except for those describing the vertical propagation of sound waves. Time splitting is applied between the dynamics that is forced by slow physics on the one hand and horizontal diffusion, tracer transport, and fast physics. One complete time step typically includes 5 dynamical sub-steps. The average air mass flux of the dynamical  sub-steps is provided to the tracer transport to allow for a mass-consistent transport. For stabilization of the divergence term on the triangular C-grid the divergence in a triangle is computed from modified normal wind components resulting from a weighted average including normal winds on edges of adjacent cells. Further divergence damping is applied to the normal wind at every sub-step. Rayleigh damping is applied to the vertical wind in layers close to the model top in order to avoid the reflection of gravity waves. The horizontal diffusion, which is applied at full model time steps, combines a flow dependent Smagorinsky scheme with a background 4th-order Laplacian diffusion operator. For tracer transport a flux form semi-Lagrangian scheme with monotone flux limiters is used, which grants local mass conservation and consistency with the air motion. The numerical methods have been chosen for high numerical efficiency, and they rely on next-neighbor communication only, thus allowing massive parallelization.

\subsection{Model for Prediction Across Scales (MPAS)}

The Model for Prediction Across Scales (MPAS) \citep{skamarock2012multiscale} uses an Arakawa C-grid built on a centroidal Voronoi tessellation (see section \ref{sec:grid_ccvt}), in conjunction with the mimetic TRiSK discretization \citep{thuburn2009numerical,ringler2010unified}.  Advection terms are nominally third- to fourth-order and are handled in accordance with \cite{skamarock2011conservative}.  In the vertical, MPAS employs a Lorenz-type second-order nodal finite volume method with a smoothed terrain-following height coordinate.  The prognostic variables are dry air pseudodensity $\tilde{\rho}_d$, dry momentum $\tilde{\rho}_d \vb{u}$, and a modified moist potential temperature.  Integration in time is handled via the split-explicit method of \cite{klemp2007conservative}.  Various filters are available for controlling spurious oscillations, including Smagorinsky-type eddy viscosity, and fourth-order hyperdiffusion.

\subsection{Non-hydrostatic ICosahedral Atmospheric Model (NICAM)}

NICAM uses the finite-volume discretization of the fully compressible non-hydrostatic Euler equations on a geodesic grid optimized by the spring dynamics method proposed by \cite{tomita2002optimization}. The system of equations is transformed to the standard terrain-following height coordinate system \citep{tomita2004new}. Instead of the temperature or the potential temperature, the total energy is chosen as a prognostic variable, following the method of \citep{satoh2002conservative, satoh2003conservative}. All of the prognostic variables are collocated horizontally at the mass centroid of each hexagonal/pentagonal cell to mitigate accuracy reduction under cell averaging, which is required in converting cell integrated quantities to point values at cell centroids. The use of cell centroids ensures quasi second-order accuracy of the gradient and divergence operators of NICAM \citep{tomita2001shallow}. The Arakawa C-grid staggering is used vertically. A two-stage Runge-Kutta scheme is usually used to reduce computational burden although a three-stage Runge-Kutta scheme \citep{wicker2002time} is recommended. The split-explicit time discretization is used for the horizontally propagating sound waves with the divergence damping term \citep{skamarock1992stability}. The implicit time discretization is adopted for the vertically propagating one. A variant of the piecewise linear transport scheme \citep{miura2007upwind, niwa2011three} is used with a flux limiter of \cite{thuburn1997pv} for passive tracer transports.

\subsection{Ocean-Land-Atmosphere Model (OLAM)}

OLAM \citep{walko2008ocean, walko2008ocean2, walko2011direct} is a deep-atmosphere, fully-compressible model that solves the equations of motion in finite-volume momentum conservation form. Acoustic modes are solved explicitly in the horizontal and implicitly in the vertical by means of time splitting. Equations are discretized with a C-grid formulation on a hexagonal Voronoi mesh with optional local mesh refinement (which introduces some pentagons and heptagons). Height is the vertical coordinate, and a Lorenz vertical grid staggering is used. A unique feature of OLAM is that grid levels are horizontal and intersect topography. This avoids a number of well-documented errors associated with terrain-following grids and also eliminates the need for evaluation of coordinate transformation terms. Topography is represented as a smooth (non-stepped) surface by means of cut cells whose surfaces and volume are reduced according to the portion of each cell that is below ground. The OLAM cut-cell formulation conserves mass and momentum.

\subsection{Tempest}

The Tempest model \citep{ullrich2014global, guerra2016high} is an experimental testbed for high-performance numerical methods that uses a horizontal spectral element discretization and vertical nodal finite volume method with Lorenz staggering based on the cubed-sphere grid with terrain-following height-based coordinate.  The implementation includes both fully explicit time integration, and a horizontally-explicit vertically-implicit formulation that is solved with a third-order implicit-explicit additive Runge-Kutta scheme from \cite{ascher1997implicit}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Model Grids} \label{sec:ModelGrids}

Model grids are a primary concern for dynamical cores, since they determine how degrees of freedom are distributed across the globe \citep{staniforth2012horizontal}.  In order to meet demands for high computational efficiency and equal partitioning of computation across large parallel systems, modern dynamical cores have been exploring a number of options for model grids.  The choice of model grid can be motivated by simplicity, as in the case of the latitude-longitude grid, by a desire to maintain a local Cartesian structure, as with the cubed-sphere grid, or to support grid isotropy and homogeneity, as with many of the hexagonal or Voronoi grids that have been employed.  The choice of grid may be further decided by the numerical method -- for instance, most finite element models rely on grids consisting entirely of quadrilaterals.  Inevitably a choice must be made, and the pros and cons of that choice will have repercussions throughout the remainder of the model.  To better understand the options that are available to dynamical core developers, we begin by reviewing many of the model grids that have been employed in global dynamical cores around the world.

\subsection{Latitude-longitude grid} \label{sec:grid_rll}

The classic latitude-longitude grid consists of a subdivision of the sphere produced by subdividing along lines of constant latitude and longitude.  Because of the convergence of grid lines near the poles, the operational use of this grid requires that the associated numerical scheme be resilient to arbitrarily small Courant number, or that polar filtering be employed to remove unstable computational modes \citep{lin2004vertically}.  This grid is employed by the UK Met Office \citep{davies2005new, wood2014inherently}.

\subsection{Cubed-sphere grid} \label{sec:grid_cs}

The equiangular gnomonic cubed-sphere grid \citep{sadourny1972conservative, ronchi1996cubed, PL2007JCP} consists of six Cartesian patches arranged along the faces of a cube which is then inflated onto a spherical shell.  More information on this choice of grid can be found in \cite{ullrich2014global}.  On the equiangular cubed-sphere grid, coordinates are given as $(\alpha, \beta, p)$, with central angles $\alpha, \beta \in [- \frac{\pi}{4}, \frac{\pi}{4}]$ and panel index $p$.  The structure of this grid supports refinement through stretching \citep{Schmidt1977,harris2016high} or nesting \citep{harris2013two}.  The Cartesian structure of cubed-sphere grid panels is advantageous for numerical methods that are formulated in Cartesian coordinates, or that utilize dimension splitting.  Nonetheless, special treatment of the panel boundaries is often necessary since they represent coordinate discontinuities.  This grid is depicted in Figure \ref{fig:CubedSphereGeodesicMesh} (left).

\begin{figure}
\begin{center}
\includegraphics[width=2in,trim={0cm 4.7cm 0cm 4cm},clip]{CubedSphereMesh.pdf} \quad \includegraphics[width=2.2in, trim={4cm 8.2cm 4cm 8.2cm},clip]{ICON_grid_nested_schematic.pdf} \quad \includegraphics[width=2.2in, trim={4cm 8.2cm 4cm 8.2cm},clip]{ICON_grid_dual_R2B3_noWorldMap.pdf}
\end{center}
\caption{(Left) A cubed-sphere grid.  (Center) An icosahedral (triangular) grid with additional refinement over Europe, as indicated in red.  (Right) An icosahedral (hexagonal) grid.} \label{fig:CubedSphereGeodesicMesh}
\end{figure}



%FV$^3$ is discretized on the equiangular gnomonic cubed-sphere grid as described in \citet{PL2007JCP}. The gnomonic cubed sphere was found to yield the best balance of uniformity and simplicity for use with the FV algorithm. The structure of this grid supports refinement through stretching \citep{Schmidt1977,harris2016high} or nesting \citep{harris2013two}.  The convention for panel numbering used in FV$^3$ differs from that described above, so that odd-numbered panels are adjacent to the next-higher-numbered panel on their right-hand side, and even-numbered panels are adjacent to the next-higher numbered panel on their top side. 

\subsection{Icosahedral (triangular) grid} \label{sec:grid_ico_tri}

For the common global applications, the icosahedral triangular grid is derived from the spherical icosahedron that consists of 20 equilateral spherical triangles, 30 great circle edges and 12 vertices.  These initial triangles are then subdivided repeatedly until the desired mean resolution is obtained. For a single subdivision each edge is divided in $n$ arcs of equal length, thus defining new vertices, which by proper connection to other new vertices result in $n^{2}$ triangles filling the original triangle. By construction the new vertices share 6 triangles, thus the refinement process brakes the initial isotropy of the icosahedron and results in non-equilateral triangles of different sizes.

Several methods are available for subdividing the triangular regions.  One such approach is implemented by the ICON grid generator, which allows an ``arbitrary'' subdivision factor $n$ for the first refinement step only, the so-called root refinement. Typical choices are $n$ = 2, 3 or 5. All additional $m$ refinement steps use $n$ = 2, i.e. are bisection steps. A global grid resulting from a root division factor $n$ and $m$ bisections, denominated as \textit{RnBm} grid,  has $n_c = 20 \cdot n^2 \cdot 2^{2m}$ cells, $n_e = 3/2 \cdot n_c$ edges and $n_v = 10\cdot n^{2}\cdot 2^{2m}+2$ vertices. The anisotropy of global grids is reduced by the spring dynamics of \cite{tomita2001shallow}.  An example of such a grid is depicted in Figure \ref{fig:CubedSphereGeodesicMesh} (center).  For a discussion of the effective resolution see \cite{dipankar2015large}.  The ICON grid generator further allows for inset regional grids, produced by additional refinement steps that are only applied over a limited region, or set of regions.  The dynamical core then allows for either one-way or two-way coupling of the refined region to the parent model. The current operational numerical weather prediction of the Deutscher Wetterdienst (German Weather Service, DWD) for instance uses a $R3B7$ global grid with 2949120 cells and 13 km mean resolution in combination with a refined region over Europe at 6.5 km resolution.

\subsection{Icosahedral (hexagonal) grid / geodesic grid} \label{sec:grid_geo}

The icosahedral (hexagonal) grid, also commonly referred to as the geodesic grid, is obtained by taking the dual to the icosahedral (triangular grid), namely by replacing grid nodes with spherical polygons.  Their cells are hexagonal, except for twelve pentagonal cells.  Given a icosahedral-triangular mesh, vertices of the corresponding icosahedral-hexagonal mesh are defined as either circumcenters or barycenters of triangles, leading to either a Voronoi mesh, used by DYNAMICO, or a barycentric mesh, used by NICAM.  A Voronoi mesh has the property that triangular edges are perpendicular to edges of hexagons/pentagons, facilitating the formulation of certain finite-difference and finite-volume numerical schemes.  The resulting highly homogeneous and isotropic grid then appears analogous to the grid in Figure \ref{fig:CubedSphereGeodesicMesh} (right).  Unlike the cubed-sphere and icosahedral (triangular) grid, grid cells on this geodesic grid are guaranteed to be edge-neighbors (cells that share a given edge) if they are also node-neighbors (cells that share a given node).

It is useful to optimize icosahedral-hexagonal grids as well.  DYNAMICO applies a number of iterations of Lloyds algorithm \citep{lloyd1982least}, following which one replaces the vertices of the original triangular mesh by the centroid of hexagons/pentagons, then re- generates the icosahedral-hexagonal mesh. This improves the homogeneity of the grid (e.g. ratio of largest cell area to smallest cell area) but several thousand iterations may be required for a significant improvement.

OLAM optimizes by applying the spring dynamics method of \cite{tomita2001shallow} to the dual triangular mesh prior to its mapping to the Voronoi grid. When local mesh refinement is applied, which OLAM achieves in a series of one or more resolution-doubling steps, each spanning a transition zone that is three grid rows wide (Figure \ref{fig:OLAMRefinement}), the equilibrium spring length is scaled to the target grid cell size in each refinement level and is varied incrementally across the transition zone. Spring dynamics is further modified by forcing angles on the dual triangular mesh in the transition zone in order to move the triangle edges closer to the centers of the hexagon edges they intersect.

\begin{figure}
\begin{center}
\includegraphics[width=2.5in]{OLAM_Grid_Refinement.png}
\end{center}
\caption{Detail of one step of local mesh refinement used by OLAM Voronoi mesh. The transition zone is constructed by explicit topological reconnection of the grid lines, which produces pairings of heptagons (red dots) and pentagons (blue dots) along the refinement perimeter.} \label{fig:OLAMRefinement}
\end{figure}

\subsection{Constrained Centroidal Voronoi Tessellation (CCVT) grids} \label{sec:grid_ccvt}

Given a set of $N$ distinct points on the sphere $x_i$ (referred to as the generators, $1 \leq i \leq N$), the \textit{Voronoi tessellation} (or the \textit{Voronoi diagram}) associated with the generators is the set of polygons $\Omega_i$ consisting of all points that are closer (in the sense of great-circle distance) to $x_i$ than any other $x_j$ with $i \neq j$ \citep{okabe2009spatial}.  For a given set of generators, this tiling is unique and completely covers the sphere, and so can be employed in conjunction with many finite volume methods.  However, for an arbitrary set of generators it is easy to produce highly distorted polygons, particularly if the density of generators varies substantially.  This has led to the development of \textit{constrained centroidal Voronoi tessellation (CCVT)} \citep{du2003constrained}, which imposes the additional requirement that the set of generators be coincident with the centroids of each polygon.  Given a desired polygonal density function, several algorithms have been developed to generate CCVTs both in Cartesian and spherical geometry (i.e. for ocean basins or ice sheets) \citep{ringler2008multiresolution}.  Figure \ref{fig:CCVT} depicts one such CCVT grid that is compatible with the MPAS model.  CCVT grids are often confused with deformations of the icosahedral (hexagonal) grid described in section \ref{sec:grid_geo}, since both typically contain a large number of hexagonal elements.  However, CCVT grids are fundamentally constructed using a very different technique and will often contain polygonal elements with more than six sides.

\begin{figure}
\begin{center}
\includegraphics[width=2in]{CentroidalVoronoiTessellation.png}
\end{center}
\caption{A constrained centroidal Voronoi tessellation grid with localized grid density that could be employed in the MPAS model.} \label{fig:CCVT}
\end{figure}

\subsection{Octahedral reduced Gaussian grid} \label{sec:grid_oct}
\label{subsection:octahedralreducedgaussiangrid}

As with the classical reduced Gaussian grid of \cite{hortal1991use}, the octahedral 
reduced Gaussian grid \citep{malardel2016new,smolarkiewiczetalJCP2016} specifies the latitudes according to the 
roots of the Legendre polynomials. 
The two grids differ in the arrangement of the points along the latitudes, which follows a simple
rule for the octahedral grid: starting with 20 points on the first latitude around the poles, four points 
are added with every latitude towards the equator, whereby the spacing between points along the 
latitudes is uniform and there are no points at the equator. The octahedral reduced Gaussian grid 
is suitable for transformations involving spherical harmonics, and has been introduced for global 
medium-range numerical weather prediction with the spectral dynamical core of the IFS at ECMWF in 2016. 
Figure~\ref{fig:octahedralgrid} depicts the octahedral reduced Gaussian grid nodes together with
the edges of the primary mesh as applied in the context of the finite-volume discretisation of FVM (Section~\ref{sec:FVM}). 


\begin{figure}
\centering
\begin{subfigure}{.4\textwidth}
  \centering
  \includegraphics[width=6cm]{contributions/FVM/octahedral_gauss_nodes}
 \end{subfigure}%
\begin{subfigure}{.4\textwidth}
  \centering
  \includegraphics[width=5.4cm]{contributions/FVM/octahedral_RGG_white}
 \end{subfigure}
\caption{Locations of the octahedral reduced Gaussian grid nodes (left), and the edges of the primary mesh 
connecting the nodes as applied with the finite-volume discretisation in FVM (right). A coarse grid with only
24 latitudes between pole and equator is used for illustration. The dual mesh resolution of the octahedral
reduced Gaussian grid is about a factor 2 finer at the poles than the equator; see \cite{smolarkiewiczetalJCP2016}.}
\label{fig:octahedralgrid}
\end{figure}


\subsection{Yin-Yang grid} \label{sec:grid_yinyang}

The overset Yin-Yang grid \citep{kageama2004yinyang} has two Cartesian grid components (subsets of a latitude-longitude grid) which are geometrically identical (see Figure \ref{fig:gem_yinyang}).  These components are combined to cover a spherical surface with partial overlap along their borders.  The Yin component covers the latitude-longitude region
\begin{equation}\label{eq:gem_yinyang}
(-\frac{\pi}{4}-\delta_{\theta} \leq \theta \leq
\frac{\pi}{4}+\delta_{\theta})  \cap
(-\frac{3\pi}{4}-\delta_{\lambda} \leq \lambda \leq
\frac{3\pi}{4}+\delta_{\lambda}),
\end{equation} where $\delta_{\lambda}, \delta_{\theta}$ are small buffers that are proportional to the respective grid-spacings and are required to enforce a minimum overlap in the overset methodology.  For instance, a common configuration employed by the GEM model for DCMIP fixes
$ \delta_{\theta}=2 $ degrees and $ \delta_{\lambda}=3 \delta_{\theta}$.  The Yang component covers an analogous area, but is rotated perpendicularly so as to cover the region of the sphere outside of the Yin grid.  This grid is employed by the GEM model, utilizing a pair of regional climate models on the two Cartesian patches.

\begin{figure}[]
\includegraphics[height=6cm]{gem_yinyang.png}
\caption{Th Yin-Yang grid, a combination of two limited-domain latitude-longitude grids assembled to provide complete coverage of the sphere.}
\label{fig:gem_yinyang}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Variable placement and prognosis} \label{sec:VariablePlacement}

Although the horizontal grid determines the approximate density and distribution of grid points, the placement of prognostic (and diagnostic) variables within each grid volume is still free to be specified.  Hence, in this section we turn our attention to the placement of prognostic variables on the grid, the choice of vertical coordinate, and the choice of corresponding prognostic equations.

\subsection{Horizontal staggering} \label{sec:HorizontalStaggering}

The horizontal placement of variables impacts a number of properties of the numerical method, including how energy and enstrophy conservation is managed, any computational modes that might arise due to differencing, and the dispersion properties of the method \citep{randall1994geostrophic}, and the maximum stable timestep size \citep{ullrich2014understanding}.  The original four Arakawa grids \citep{arakawa1977computational}, denoted with letters A- through D- were initially designed for rectilinear meshes, but were later adapted for a variety of unstructured grids.  Later, other grid types were added, including the Z-grid, which used the vertical component of vorticity and the horizontal divergence in place of the velocity components \citep{randall1994geostrophic}, and the ZM-grid, which extends the B-grid to hexagons by placing the velocity at hexagonal nodes \citep{ringler2002zm}.  New staggerings are now being developed in the context of finite element methods, using mixed finite element methods \citep{cotter2012mixed}.  Among the models that participated in DCMIP, only four grids were represented:  The A-grid, which involves co-location of all velocity components; the C-grid, which places perpendicular velocity components on grid edges; the D-grid, which places parallel velocity components on grid edges; and the Z-grid (see Figure \ref{fig:horizontalstaggering}).

There are arguments to be made for and against each of these grids:  the A-grid is relatively simple to implement and tends to support large time step sizes, but also supports a $2 \Delta x$ computational mode (even in the context of finite element methods); the C-grid has excellent dispersion properties, and does not support extraneous computational modes (as long as the number of edges is equal to twice the number of volumes), but also requires a timestep that is half that of the A-grid; the D-grid provides a better representation of vorticity, but suffers to similar computational modes as the A-grid that must be controlled with divergence damping; finally, the Z-grid yields optimal dispersion properties, but requires the inversion of a Helmholtz problem at each timestep to extract the velocity field from the divergence and vorticity.

%----------------------------------------------------
\begin{figure}[]
\includegraphics[width=5in, clip, trim=0cm 2.0cm 0cm 0cm]{HorizontalStaggering.pdf}
\caption{Horizontal staggering options represented among DCMIP models, in this case depicted on a rectilinear grid and geodesic grid.  Here $\eta$ denotes the buoyancy variable.}
\label{fig:horizontalstaggering}
\end{figure}
%----------------------------------------------------

\subsubsection{C-D-Grid in the FV$^3$ model} \label{sec:CDGrid}

Although velocities in the FV$^3$ model are stored in accordance with the D-grid arrangement, at the intermediate stages of the forward-backwards timestepping scheme, velocities are actually prognosed on the C-grid.  The intermediate velocities then act as a simplified Riemann solver:  the intermediate stage velocities are time-centered and can be used to compute the fluxes and advance the flux terms by a full acoustic timestep.  More details on this approach can be found in \cite{LR1997QJR}.

\subsection{Vertical staggering} \label{sec:VerticalStaggering}

Along with the choice of prognostic variables, the vertical discretization of the equations of motion also allows for the staggered placement of prognostic variables.  As with hydrostatic models, certain discretizations give rise to spurious computational modes that can contaminate the solution \citep{tokioka1978some,arakawa1988baroclinic}.  The choice of vertical staggering may also impact many physically-relevant properties of the model near the grid scale, such as the phase speed of Rossby waves \citep{thuburn2005vertical}.  Finally, the choice of vertical staggering can have impacts on the physics-dynamics coupling \cite{holdaway2013comparison1,holdaway2013comparison2}.  Taken altogether, these issues suggest care should be taken when selecting the discretization.  Since co-located discretizations of the non-hydrostatic equations generally require some additional effort to control spurious computational modes, it is more common to employ either: (a) a Lorenz-type staggering \citep{lorenz1960energy}, which places horizontal velocity, buoyancy, and thermodynamic variables on model levels, and vertical velocity on model interfaces; or (b) a Charney-Phillips-type staggering \citep{charney1953numerical}, which places horizontal velocity and buoyancy variables on model levels and vertical velocity and thermodynamic variables on model interfaces (see Figure \ref{fig:verticalstaggering}).  These approaches can be further augmented as needed, for instance by shifting the vertical velocity and thermodynamic variables from the bottom boundary to an intermediate level, as in the GEM model.  Note that, in general, tracer variables are co-located with the buoyancy variable.

%----------------------------------------------------
\begin{figure}[]
\includegraphics[width=5in]{VerticalStaggering_v2.pdf}
\caption{(a) A Lorenz-type variable staggering for a model utilizing height coordinates, (b) a Charney-Phillips-type variable staggering for a model utilizing height coordinates, (c) a modified Charney-Phillips-type staggering used in the GEM model that introduces a new near-surface level for vertical velocity and temperature.}
\label{fig:verticalstaggering}
\end{figure}
%----------------------------------------------------

\subsection{Vertical Coordinates} \label{sec:VerticalCoordinates}

Most atmospheric models use dimension splitting in order to separate the evolution equations for momentum into horizontal and vertical directions.  Whereas ``horizontal'' in this context either refers to either contravariant velocities, which are perpendicular to the vertical, or covariant velocities, which are directed along coordinate (e.g. terrain-following) surfaces, the vertical is strictly aligned with the radial vector pointing from the center of the Earth.  In this context, the use of dimension splitting allows us to choose an arbitrary function $s(t,\vb{x},z)$ that is monotonic in $z$, so that model interfaces are equally spaced with respect to $s$.  Typically $s$ is chosen so that the Earth's surface (the bottom boundary of the atmosphere) is a coordinate surface, allowing for easy specification of boundary conditions for the prognostic equations -- this leads to the so-called ``terrain-following'' family of vertical coordinates.  Perhaps the most common terrain-following coordinate is from \cite{galchen1975}, which is in terms of the altitude $z$ and takes the form
\begin{align}
s(\vb{x},z) = z_{\footnotesize \mbox{top}} \left[ \frac{z - z_s(\vb{x})}{z_{\footnotesize \mbox{top}} - z_s(\vb{x})} \right],
\end{align} where $\vb{x}$ denotes the horizontal position, $z_s(\vb{x})$ is the height of the topography at that position, and $z_{\footnotesize \mbox{top}}$ denotes the height of the model top (typically independent of position).  Analogous formulations are available for mass-based ($\sigma$-coordinates) and entropy-based vertical coordinates.  Because the sharp variations in the coordinate surfaces are preserved far above a rough lower-boundary, new coordinate formulations have been proposed that smooth coordinate surfaces, such as \cite{schar2002new} or \cite{klemp2011terrain}.  All models in this paper except for OLAM use some variant of terrain-following coordinates, although work on developing modern cut-cell, embedded boundary and immersed boundary representations is ongoing (e.g. \cite{lock2012demonstration}).  Note that time-dependent vertical coordinates are allowed and are typically referred to as ``floating'' coordinates.  Several examples of vertical coordinates are now given.

\subsubsection{Mass-based coordinates}

Mass-based coordinates are a generalization of pressure-based coordinates to non-hydrostatic models, with a vertical coordinate defined as the total gravity-weighted overhead mass,
\begin{align} \label{eq:s_mass-based}
s = \int^{\infty}_{z} \rho g dz.
\end{align}  Under this definition,
\begin{align}
\pdiff{s}{z} = - \rho g.
\end{align}

The mass-based coordinate gives rise to a prognostic equation for hydrostatic surface pressure through vertical integration of (\ref{eq:PrognosticPseudoDensity}),
\begin{align} \label{eq:SurfacePressureEquation}
\pdiff{}{t} \int \rho_s ds + \int \nabla_s \cdot (\rho_s \vb{u}_h) ds = 0,
\end{align} where the integrals are taken over the column.

\subsubsection{GEM zeta coordinate} \label{sec:GEM_zeta}

The vertical coordinate in the GEM model, denoted $\zeta$, is a hybrid terrain-following coordinate of a log-hydrostatic-pressure type.  Taking $s$ (denoted $\pi$ in GEM documentation) as given in (\ref{eq:s_mass-based}), then $\zeta$ is given by the relation
\begin{align}\label{eq:gem_zeta}
\log s = A(\zeta) + B(\zeta) \left[ \log s(z_s)  - \zeta_s \right],
\end{align}
\noindent with
\begin{align}
A(\zeta) = \zeta, \quad \mbox{and} \quad B(\zeta) =\left( \frac {\zeta-\zeta_{top}} {\zeta_s -\zeta_{top}} \right)^r.
\end{align}
Here  $\zeta_s = \log(10^5)$, $\zeta_{top} = \log(s_{top})$,
and $r$ is a variable exponent providing added freedom for adjusting the thickness of model layers over high terrain.

\subsubsection{Floating Lagrangian coordinates (DYNAMICO, FV$^3$ and HOMME)} \label{sec:FloatingLagrangian}

In the floating Lagrangian formulation \citep{starr1945quasi, lin2004vertically} the vertical coordinate is chosen to represent an artificial tracer with monotonically increasing or decreasing mixing ratio $s$ in the vertical.  The actual mixing ratio at initiation is arbitrary, and can be constructed to be height-like (i.e., $s = z$), or mass-like, i.e.
\begin{align}
s = \int^{\infty}_{z} \rho_0 g dz,
\end{align} in which case a 3D reference density field $\rho_0$ can be imposed.  Of primary importance is the fact that the vertical coordinate satisfy
\begin{align}
\dot{s} = \frac{ds}{dt} = 0,
\end{align} which greatly simplifies the associated prognostic velocity and continuity equations.  Floating Lagrangian coordinates are often paired with a vertical remapping operation that corrects for strong grid distortions that may occur after sufficiently long model integrations.

\subsubsection{Cut-cells in OLAM} \label{sec:CutCells}

A pure z coordinate with horizontal grid levels is used in OLAM \citep{walko2008ocean2} in order to completely avoid topographic imprinting on the model grid levels (Figure \ref{fig:OLAM_CutCell}). This implies that grid levels intersect the topographic surface, leading to some grid cells being partially above and partly below the surface. The face areas of these so-called cut cells are reduced accordingly, which in turn regulates cell-to-cell flux transport in accordance with the kinematic constraint imposed by the topography. Cut cell volumes are also reduced, and volumes and surface areas of all cells appear explicitly in the finite-volume formulation of the mass and momentum conservation equations.

\begin{figure}
\begin{center}
\includegraphics[width=2in]{OLAM_CutCellA.png} \quad \includegraphics[width=2in]{OLAM_CutCellB.png}
\end{center}
\caption{(Left) A terrain-following coordinate passing over rough topography.  (Right) A cut-cell coordinate used for representing the same topography.} \label{fig:OLAM_CutCell}
\end{figure}

\subsection{Prognostic equations} \label{sec:PrognosticEquations}

The Navi\'er-Stokes equations that govern atmospheric motion can take on many forms, depending on the choice of prognostic variables and coordinate system.  A derivation of many forms of these equations can be found in Appendix \ref{sec:EquationSets}.  The particular equations used by the model, and the discrete form of these equations, can impact many important aspects of the model, including the presence of computational modes, the accuracy of the model in representing the physical modes of the atmosphere \citep{thuburn2005vertical}, and the ability of the model to conserve important invariants such as energy \citep{Dubos2014Equations}.  The remainder of this section gives some specific examples of prognostic equations used by the DCMIP models.

\subsubsection{DYNAMICO} \label{sec:DYNAMICOEquations}

The prognostic equations employed by DYNAMICO are based on a Hamiltonian formulation \citep{Dubos2014Equations}. The specific prognostic variables employed pseudo-density $\rho_s$, mass-weighted tracers (potential temperature, water species), geopotential $\Phi$, ``horizontal'' covariant components of momentum and mass-weighted vertical momentum $W = \rho_s g^{-2} d\Phi/dt = \rho_s g^{-1} w$. Prognostic equations are in flux-form for mass (\ref{eq:PrognosticPseudoDensity}) and $W$ (\ref{eq:PrognosticVelocityFluxForm}), in advective form for $\Phi$ (\ref{eq:PrognosticShallowGeopotential}), and in vector-invariant form for covariant horizontal momentum (\ref{eq:CovariantUpdateEquation}).

\subsubsection{FV$^3$} \label{sec:FV3Equations}

The hydrostatic FV$^3$ model uses a mass-based floating Lagrangian coordinate along with the shallow-atmosphere approximation \citep{lin2004vertically}.  Prognostic equations include horizontal velocity in 2D vector-invariant form (\ref{eq:PrognosticUhEquationK2}), pseudo-density (\ref{eq:PrognosticPseudoDensity}), and virtual potential temperature (\ref{eq:PrognosticPseudoDensityTheta}).  The non-hydrostatic model further incorporates prognostic geopotential (\ref{eq:PrognosticShallowGeopotential}) and vertical momentum (\ref{eq:PrognosticWEquationK2}).

\subsubsection{FVM} \label{sec:FVMEquations}

FVM solves conservation laws for dry mass \eqref{fvm:mass}, momentum \eqref{fvm:momentum}, and dry 
entropy \eqref{fvm:thermodynamic} in Eulerian flux-form,
which are similar to \eqref{eq:ContinuityEquation} for $\rho_d$, \eqref{eq:PrognosticVelocityFluxForm}, and 
\eqref{eq:PotentialTemperatureFluxForm} for $\theta$, respectively. Underlying the governing equations 
in FVM is a perturbational form with respect to a balanced ambient state, and a generalized curvilinear 
coordinate formulation in a geospherical framework. These governing equations can 
concisely be written as
\citep{smolarkiewiczetalJCP2017}
\begin{subequations} \label{fvm:compressible}
\begin{align}
 & \pdiff{\mathcal{G}\rho_d}{t} + \overline{\nabla} \cdot \left(\mathbf{v} \mathcal{G} \rho_d\right) = 0~,
\label{fvm:mass}  \\
& \pdiff{\mathcal{G} \rho_d \mathbf{u}}{t} + \overline{\nabla} \cdot \left[\mathbf{v} \mathcal{G} \rho_d \mathbf{u} \right) = 
\mathcal{G}\rho_d\left( - \theta_{\rho} \mathbf{\widetilde{G}} \overline{\nabla} \phi' 
- \mathbf{k} \frac{g}{\theta_{a}} \left(\theta'+\theta_a \left(\frac{q'_v}{\varepsilon} - q'_v - q_c - q_r \right) \right)
- 2\mathbf{\Omega} \times \left( \mathbf{u} - \frac{\theta_{\rho}}{\theta_{\rho\,a}} \mathbf{u}_{a} \right) 
+ \mathcal{M}' \right]~,
%+ \mathbf{M} \right)~,
\label{fvm:momentum} \\
%- \frac{L}{c_p \pi} & \Big( \frac{\Delta q_{vs}}{\Delta t} & + E_r  \Big)
& \pdiff{\mathcal{G}\rho_d \theta'}{t} + \overline{\nabla} \cdot \left(\mathbf{v}\mathcal{G}\rho_d\,\theta' \right) = 
- \mathcal{G}\rho_d\,\mathbf{\widetilde{G}}^{T}\mathbf{u} \cdot \overline{\nabla} \theta_{a} ~,
%- \frac{L}{c_{pd}\,\pi} \left( \frac{\Delta q_{vs}}{\Delta t}  + E_r  \right) %\left(C_d + E_p\right) 
%+  \mathcal{H} \right)~,
\label{fvm:thermodynamic} \\
& \phi' = c_{pd} \left[\left( \frac{R_{d}}{p_{0}} \rho_d\,\theta\,(1+q_v/\varepsilon) \right)^{R_{d}/c_{vd}} - \pi_{a} \right]~.
\label{fvm:gaslaw}
\end{align}
\end{subequations}
Dependent variables in \eqref{fvm:compressible} are dry density $\rho_d$, 3D
physical velocity vector $\mathbf{u}$, potential temperature perturbation $\theta'$, and a modified
Exner pressure perturbation $\phi'$, 
with the thermodynamic variables related by the gas law 
\eqref{fvm:gaslaw}. Primes indicate perturbations with respect to the prescribed ambient state denoted by
subscript `a' (see also \cite{prusa2008eulag,smolarkiewiczJCP2014}).   As far as geometric aspects are concerned, the nabla operator $\overline{\nabla}$ represents
the 3D vector of partial derivatives with respect to the curvilinear coordinates, along with the Jacobian $\mathcal{G}$, 
a matrix of metric coefficients $\mathbf{\widetilde{G}}$, its transpose $\widetilde{\mathbf{G}}^{T}$, and 
the contravariant velocity $\mathbf{v} = \mathbf{\widetilde{G}}^{T}\mathbf{u}$; see also \cite{prusa2003all} 
and \cite{kuehnleinJCP2012}.
The symbol $\mathcal{M}'(\mathbf{u}, \mathbf{u}_a, \theta_{\rho}/\theta_{\rho\,a})$ in \eqref{fvm:momentum} 
subsumes the spherical Christoffel symbols \citep[][]{smolarkiewiczetalJCP2017}.

\subsubsection{GEM} \label{sec:GEM_equations}

%GEM is a semi-Lagrangian model with a hybrid coordinate of a log-hydrostatic-pressure type, here denoted $\zeta$, described in section \ref{sec:GEM_zeta}.
In GEM the non-hydrostatic equations are written explicitly as deviations from hydrostatic balance represented by
\begin{align}
\mu = \pdiff{p}{s} - 1,
\end{align}
\noindent where $s$ (denoted $\pi$ in GEM documentation) is given by (\ref{eq:s_mass-based}).  In this case the equations of GEM model \citep{Girard2014} are concisely given by
\begin{align}
\frac{d \vb{u}_h }{dt} + f {\bf k} \times {\bf{u}_{h}} + R_d T_v\nabla_\zeta \,  \log\, p+ \left( 1 + \mu \right) \nabla_\zeta {\Phi} &= 0, \\
\frac{d w}{dt}- g \mu &= 0, \\
\frac{d}{dt} \log \left( \pdiff{s}{\zeta}\right) + \nabla_{ \zeta }\cdot {\bf u}_{{h}}+\frac{\partial \dot{ \zeta }}{\partial \zeta } &= 0, \\
\frac{d \log T_v}{dt} - \frac{R_d}{c_p} \frac {d \log p} {dt} &= 0, \\
\frac{\partial \Phi}{\partial s} + \frac{R_dT_v}{p} &= 0, \\
\frac{d \Phi}{dt}-  g w & = 0.
\end{align}

%\noindent with horizontal velocity ${\bf V}_h$, 
%generalized vertical velocity $\dot{ \zeta }=\frac{d\zeta}{dt}$, 
%vertical velocity $w$,
%geopotential $\phi$, 
%virtual temperature $T_v$, 
%pressure $p$ and
%hydrostatic pressure $\pi$. The variable 
%$\mu$ is a measure of departure from hydrostatic balance, 
%$s$ is related to the surface pressure $\pi_s$ and $B$ is a metric term. The last two variables are defined in (\ref{eq:gem_zeta}).

\subsubsection{HOMME}

HOMME uses a floating Lagrange formulation (section \ref{sec:FloatingLagrangian}) for tracer advection and optionally for the vertical dynamics. The 2D vector invariant form of the prognostic horizontal velocity equations (\ref{eq:PrognosticUhEquationK2Sb}) is employed, in conjunction with prognostic temperature (\ref{eq:VirtualTemperaturePrognosticEq}) and surface pressure (\ref{eq:SurfacePressureEquation}).

In addition to the primitive equation model, HOMME also hosts an experimental non-hydrostatic dynamical core which retains many of the features of the traditional CAM-SE model. This model makes use of the shallow-atmosphere Euler equations, as first described by \cite{laprise1992euler}. In its current incarnation, unstructured spectral elements are retained in the horizontal with matching spectral elements in the vertical. Prognostic variables include the 3d wind velocity components $u,v,w$ ((\ref{eq:PrognosticWEquationK2Sb}) and (\ref{eq:PrognosticUhEquationK2Sb})), the surface pressure $p_s$ (\ref{eq:SurfacePressureEquation}), potential temperature (\ref{eq:PotentialTemperaturePrognostic}), and geopotential (\ref{eq:ShallowAtmosphereGeopotential}).

%Planned improvements call for vertically implicit time stepping, and possible Charney-Phillips staggering.

% The physics, tracer, dynamics, and vertical remapping schemes are applied in a time split manner with adjustable sub-cycling ratios. Tracer advection is discretized in time with a 3-stage 2nd order strong stability preserving (SSP) scheme of Spitteri and Ruuth \cite{spiteri2002new}. The dynamics are also discretized using one of several explicit Runge-Kutta times schemes. Physics-dynamics coupling may be achieved using a single adjustment at the end of the physics timestep, through tendency update every dynamics step, or by a hybrid of the two.



%This model has been successfully applied to the dry DCMIP-2012 dynamical core tests including (vertical SE) tracer transport, orogoraphic waves, gravity waves, and the dry baroclinic instability. Moist dynamics, physics/dynamics coupling, and implicit time integration routines are currently under development.

\subsubsection{ICON} \label{sec:ICONEquations}

ICON is based on \cite{gassmann2008} using terrain-following $z$-coordinates with prognostic density (\ref{eq:EulerianContinuityEquation}), virtual potential temperature (\ref{eq:PrognosticPseudoDensityTheta}), horizontal momentum in vector-invariant form (\ref{eq:HorizontalVelocityOrthogonal}), and vertical momentum (\ref{eq:VerticalVelocityOrthogonal}).  The specific heat capacities and ideal gas constant are approximated to be equal to their dry values $R^\ast \approx R_d$, $c^\ast_p \approx c_{pd}$ and $c^\ast_v \approx c_{vd}$.  The model also uses a prognostic equation for Exner pressure to simplify vertical sound wave propagation, given by
\begin{align}
\pdiff{\pi}{t} + \frac{R_d}{c_{vd}} \frac{\pi}{\rho \theta_v} \nabla \cdot (\vb{u}_h \rho \theta_v) = \hat{Q},
\end{align} where $\hat{Q}$ is an appropriately formulated diabatic heat term.  The horizontal uses a Arakawa C-grid formulation on the triangular grid to prognose horizontal velocities normal to triangle edges $v_n$, making use of reconstructed tangential velocity components $v_t$.

\subsubsection{OLAM} \label{sec:OLAMEquations}

OLAM solves the deep-atmosphere, fully-compressible equations in mass- and momentum-conserving finite-volume form using equations (\ref{eq:EulerianContinuityEquation}), (\ref{eq:PrognosticVelocityFluxForm}), and 
(\ref{eq:PotentialTemperatureFluxForm}). Prognostic variables are the 3 components of momentum, ice-liquid potential temperature $\theta_{il}$ \citep{walko2000efficient}, total density $\rho$, specific density of total water, and specific bulk density and/or bulk number concentration of various scalar quantities including liquid and ice hydrometeors, aerosols, and trace gases. For DCMIP, the latter are limited to cloud and rain specific bulk densities. Water vapor density $\rho q$ is diagnosed by subtracting bulk densities of all liquid and ice hydrometeors from the total water density, dry air density is diagnosed by subtracting total water density from total density, and pressure is diagnosed based on the equation of state and values of dry air density, water vapor density, and potential temperature $\theta$. The latter is in turn diagnosed from $\theta_{il}$ and from the latent heat required to convert any hydrometeors present to the vapor phase. Velocity components are diagnosed by dividing momentum components by total density.

Momentum is C-staggered in the horizontal and vertical (Lorenz vertical staggering is used), meaning that prognosed components live on the grid cell faces and are each normal to the respective face and the pressure gradient force is evaluated and applied at those locations. However, evaluation of advective and turbulent momentum transport (as well as the Coriolis force) involves a diagnostic reconstruction of the total momentum vector at the centers of scalar grid cells \citep{perot2000conservation}, and cell-to-cell flux of momentum is computed from that reconstruction using the same A- grid control volumes as for scalars. This arrangement is particularly convenient for the cut-cell formulation at the topographic surface where reduced cell face areas and volumes regulate momentum and scalar fluxes in an identical manner.

\subsubsection{Tempest} \label{sec:TempestEquations}

Tempest is a shallow-atmosphere Eulerian model with terrain-following $z$-coordinates with prognostic density (\ref{eq:PrognosticPseudoDensity}), virtual potential temperature (\ref{eq:PrognosticPseudoDensityTheta}), and vector-invariant form for covariant horizontal velocity (\ref{eq:CovariantUpdateEquation}) and vertical momentum (\ref{eq:VerticalVelocityOrthogonal}).  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Diffusion, Stabilization, Filters and Fixers} \label{sec:DiffusionStabilization}

Most dynamical cores implement specialized techniques for diffusion or stabilization (see Table \ref{tab:ModelsTemporalDiffusion}).  Diffusion is a numerical technique that removes spurious numerical noise from the simulation, where the numerical noise typically arises because of inaccuracies in the treatment of waves with wavelengths near the grid scale.  Stabilization is a numerical technique that prevents energy growth and allows the model to be run over long periods.  Diffusion or stabilization options include physically-motivated turbulence parameterizations, added viscosity or hyperviscosity terms with tunable coefficients, off-centering, or wave-mode filters.  Since the discretization can also lead to an unphysical loss of mass or energy, mass or energy fixers are also employed to replace lost mass or energy to the system.  A comprehensive overview of schemes for diffusion and stabilization schemes can be found in \cite{jablonowski2011pros}.  In this section we discuss some of the diffusion and stabilization strategies employed by the DCMIP suite of dynamical cores.

\subsection{HOMME / Tempest}

In both HOMME and Tempest, scalar hyperviscosity is employed for $\rho$, $\theta$ and tracer variables via repeated application of a scalar Laplacian \citep{ullrich2014global}.  Vector hyperviscosity is also applied by decomposing the horizontal vector Laplacian into divergence damping and vorticity damping terms via the vector identity
\begin{align}
\nabla^2 \vb{u}_h = \nabla \nabla \cdot \vb{u}_h + \nabla \times \nabla \times \vb{u}_h.
\end{align}  Both viscosity operations are applied after the completion of all Runge-Kutta sub-cycles.  Several limiter options are available for tracer transport including a sign-preserving limiter and a monotone optimization base limiter described in \cite{guba2014optimization}.

\subsection{ICON}

The ICON model employs damping and diffusion operators for numerical stabilization and dynamic closure. The details of this scheme appear in sections 2.4 and 2.5 of \cite{zangl2014icon}, and are summarized here.  For damping, in the corrector step a fourth-order divergence damping term $F_{d}(\mathbf{v})$ is applied in order to allow calling the (relatively) computationally  expensive diffusion operator (see below) at the physics time steps without incurring numerical stability problems under extreme conditions,
\begin{align}
F_{d}(\mathbf{v}) = - f_d \overline{a_c}^2 \nabla \tilde{\nabla} \cdot \left\{\nabla \left[\tilde{\nabla} \cdot v + 
\frac{\Delta }{\Delta z} \left(w-\overline{\overline{w_{cc}}^c}^i \right)\right]\right\} \,.
\end{align}
$f_d$ typically attains values between $\frac{1}{1000 \Delta t}$ and $\frac{1}{250 \Delta t}$, and $\overline{a_c}$ is the global mean cell area.

ICON also includes Rayleigh damping on $w$ following \cite{klemp2008}, which serves to prevent unphysical reflections of gravity waves at the model top. The Rayleigh damping is restricted to a fixed number of levels below the model top, and the damping coefficient is given by a hyperbolic tangent.

The horizontal diffusion consists of a flow dependent second-order Smagorinsky diffusion of velocity ($F_{D2}(v_n)$) and potential temperature  ($F_{D2}(\theta)$) combined with a fourth-order background diffusion of velocity $F_{D4}(v_n)$, defined via
\begin{align} \label{smagn2}
F_{D2}(v_n) &= 4 K_h \tilde{\nabla}^2(v_n), & F_{D2}(\theta) &= a_c \tilde{\nabla} \cdot \left(K_h \frac{\Delta \theta}{\Delta n} \right) \,. & F_{D4}(v_n) &= - k_4 a_e^2 \tilde{\nabla}^2 (\tilde{\nabla}^2(v_n)) \,.
\end{align}
An empirically determined offset of $0.75 k_4 a_e$ is subtracted from $K_h$ in order to avoid excessive diffusion under weakly disturbed conditions.

A fourth-order computational diffusion is also available for vertical wind speed $w$. This filter term is needed at resolutions of O(1 km) or finer because the advection of vertical wind speed has no implicit damping of small-scale structures.  This term appears as
\begin{align}
F_{D}(w) = - k_w a_c^2 \nabla^2 (\nabla^2(w)).
\end{align}

\subsection{FV$^3$}

Explicit dissipation in FV$^3$ is applied separately to the divergence and to the horizontal fluxes in the governing equations. The D-grid discretization applies no direct implicit dissipation to the divergence, so divergence damping is an intrinsic part of the solver algorithm since otherwise there are no processes by which energy contained in the divergent modes is removed at the grid scale.  FV$^3$ has options for fourth-, sixth-, or eighth-order divergence damping; a second-order option is also available for use in idealized convergence tests, which can be applied in addition to the higher-order diffusion. The monotonicity constraint used in computing the fluxes in the  momentum, thermodynamic, and mass continuity equations is sufficient to damp and stabilize the non-divergent component of the flow. If additional damping is desired, or if the non-monotonic advection is used, there is an option to apply hyperdiffusion to the fluxes in each of these equations, with the exception of the tracer transport, which always uses monotonic transport with no explicit diffusion. The hyperdiffusion is of the same order as but much smaller than the divergence damping. Both divergence damping and hyperdiffusion are applied along the Lagrangian surfaces and are re-computed every acoustic timestep.

Wave absorption at the model top is also provided by the flexible-lid (constant-pressure) upper boundary;  FV$^3$ also applies second-order diffusion to all fields, except the tracers, to create a sponge layer, typically comprising the top two layers of the domain, to damp other signals reaching the top of the domain. An energy-conserving Rayleigh damping, applied consistently to all three components of the winds, is also available, which is strongest in the top layer of the domain and becomes weaker with distance until reaching a runtime-specified cut-off pressure. 

FV$^3$ has an option to restore lost energy by the adiabatic dynamics, in whole or a fraction thereof (decided by a namelist option at runtime), by globally adding a Exner-function weighted potential temperature increment. This is only done before the physics is called and is not used in idealized simulations. 

\subsection{GEM}

An explicit hyperviscosity in GEM is handled via applications of the Laplacian operator
for both wind components and tracers.
A vertical sponge layer, which uses a Laplacian operator,
is employed on wind components and $T_v$ with a vertical modulation on the topmost levels.
For stabilization purpose, the temporal discretization of GEM also uses an off-centering parameter.
The quasi-monotone semi-Lagrangian (QMSL) method \citep{Bermejo1992QMSL}
is used operationally to ensure tracer monotonicity
for specific humidity and different hydrometeors.
Other options are now available
in GEM including a mass conserving monotonic scheme \citep{Sorenson2013} and
a global mass fixer \citep{Bermejo2002MASS}. Those approaches have been evaluated using
chemical constituents such as ozone \citep{deGrandpre2016OZONE}.

\subsection{OLAM}

OLAM requires two types of artificial damping. In the upper layers of the model, vertical velocity and small-scale horizontal divergence are damped in order to attenuate gravity waves and thereby mitigate their reflection off the rigid top boundary of the domain. The damping layer is commonly applied in the uppermost 10 km of the domain, where the model top is 35 or 40 km above sea level. The damping rate is zero at the bottom of the damping layer and increases upward, usually linearly.

Throughout the model domain, vertical vorticity is filtered horizontally at the smallest resolvable scale in order to control a spurious computational mode. This vertical vorticity mode is inherent in C-staggered momentum formulations on hexagonal meshes because horizontal velocities are more numerous than twice the number of scalar (mass) values and are thus under-constrained. The vorticity filter is constructed so as to have zero impact on divergence at any scale.

Upwinding in the Lax-Wendroff formulation of the advection operator provides sufficient damping that no other type of filtering is required.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Temporal Discretizations} \label{sec:TemporalDiscretizations}

Temporal discretizations are important for capturing the discrete dynamical evolution of the global atmosphere.  In the past two decades, a variety of new temporal discretizations have been developed, leaving behind the days when the leapfrog scheme was ubiquitous across models.  This diversity is in part because of the demands of non-hydrostatic models: unlike their hydrostatic counterparts, non-hydrostatic atmospheric models that do not use the anelastic \citep{ogura1962scale}, quasi-hydrostatic \citep{orlanski1981quasi}, pseudo-incompressible \citep{durran1989improving}, or unified approximation \citep{arakawa2009unification} must include a mechanism in the temporal discretization for dealing with vertically propagating sound waves.  These waves are meteorologically insignificant, but with a vertical grid spacing of 100 meters, a purely explicit temporal discretization would require a time step size on the order of one second or less.  In this section we discuss the timestepping schemes that have been employed across the DCMIP suite of models.

\subsection{Mixed Implicit-Explicit, Forward-Backward, Semi-Implicit and Additive Runge-Kutta Schemes}

Implicit-explicit schemes are a broad category of time integration schemes that divide the terms of the prognostic equations into a set of explicitly integrated terms and implicitly integrated terms.  At the very least, terms associated with vertically propagating sound waves are included among the implicit terms.  For the remaining terms, there is some freedom in choosing how to integrate terms associated with vertical advection and horizontally propagating sound waves.  Semi-implicit schemes are one such class of schemes that typically incorporate horizontally propagating sound waves into the implicit solve, and so rely on a global Helmholtz-type solve.  Additive Runge-Kutta schemes are another mechanism to ensure high-order temporal accuracy, and many such schemes have been described throughout the literature (see, for example, \cite{weller2013runge, ullrich2012operator}).  Several examples of these schemes can be found among the DCMIP models:  

FV$^3$ and its predecessors are integrated using a forward-backwards integration for the Lagrangian dynamics. With the exception of the pressure-gradient force, all of the terms in the momentum, energy, and mass equations are expressable as fluxes, and so can be integrated using the explicit forward-in-time algorithm described by \citet{LR1997QJR}. The horizontal component of the pressure-gradient force is evaluated backwards-in-time using the algorithm of \citet{L1997QJR}; the non-hydrostatic component of the vertical pressure gradient force is evaluated using a semi-implicit solver. This forward-backward timestep is referred to as the ``acoustic'' timestep, although the full solver is advanced on each of these acoustic timesteps. Physics tendencies are applied impulsively at prescribed intervals, consistent with the forward-in-time discretization; the physics timestep is typically much longer than the acoustic timestep. 

DYNAMICO uses an additive Runge-Kutta time scheme with two Butcher tableaus, one explicit and one implicit. A Hamiltonian splitting decides which terms of the equations of motion are treated explicitly or implicitly (Dubos and Dubey, in preparation). As a result the implicit terms couple the vertical acceleration due to the pressure gradient and the adiabatic pressure change due to vertical displacements of fluid parcels. The resulting implicit problem reduces to independent, scalar, purely vertical, nonlinear problems which are solved to machine precision in two Newton iterations involving one tridiagonal solve each. The overall time scheme has a HEVI (horizontally explicit, vertically implicit) structure. Currently the second-order 3-stage scheme ARK(2,3,2) is used \citep{giraldo2013implicit}.

ICON consists of a two-time-level predictor corrector scheme, which is explicit for all terms except for those describing the vertical propagation of sound waves. No time splitting is used with respect to sound waves, because the ratio of the maximum wind speed in the mesosphere, which is in part covered by the vertical domain, can be close to one. Instead time splitting is employed to dynamics on the one hand and horizontal diffusion, tracer transport, fast physics on the other hand. Typically a full time step consists of 4 or 5 dynamical sub-steps in which a constant forcing originating from the slow physics is applied. Mass-consistent transport is achieved by passing time-averaged air-mass fluxes from the dynamical sub-steps to the transport scheme.The details of the predictor corrector scheme, including measures to increase the numerical efficiency and to optimize the accuracy, are described in section 2.4 of \cite{zangl2014icon}. 

MPAS uses a split-explicit formulation \citep{klemp2007conservative} consisting of an outer Runge-Kutta loop (typically RK3) and inner acoustic loop.  At the beginning of each Runge-Kutta sub-cycle, tendencies are computed for each of the prognostic variables and stored for the duration of the sub-cycle.  Several iterations of an acoustic loop are then performed with a time-step much smaller than require for the Runge-Kutta sub-cycle.  Within the acoustic loop, an implicit solve for vertically-integrated sound waves is performed to avoid timestep constraints that may arise from vertically-propagating sound waves.

OLAM uses a unique temporal discretization that combines elements of the Adams-Bashforth (AB2) scheme and a Lax- Wendroff formulation for advected quantities. However, instead of extrapolating all prognostic tendencies forward to the half-future time level as in AB2, the horizontal momentum components alone (not their tendencies) are extrapolated in time at the cell boundaries where they reside. The extrapolated momentum provides the time-centered cell-to-cell total mass flux across the grid cell faces that is responsible for advective transport. Advection of all quantities, including all 3 velocity components that are diagnostically reconstructed at scalar cell centers, and advancement in time from the current to the future time level is based on the time- and space-centered Lax-Wendroff formulation.   This scheme is horizontally explicit, but a trapezoidal- implicit formulation is used in the vertical for stable integration of vertically-propagating sound waves. A by-product of the implicit formulation is an implicit time-centered vertical momentum that joins the time-extrapolated horizontal momentum to form a complete set of mass fluxes for advection. The vertical momentum equation is solved first so that the time-centered vertical momentum is available for computing transport of horizontal momentum and all scalar quantities. A time-split scheme is most often used where momentum and potential temperature are updated more frequently than other scalar fields in order to accommodate horizontally propagating sound waves.

%This scheme is horizontally explicit, but a trapezoidal-implicit formulation is used in the vertical for stable integration of vertically-propagating sound waves. A by-product of the implicit formulation is an implicit time-centered vertical momentum that joins the time-extrapolated horizontal momentum to form a complete set of mass fluxes for advection. Scalar advection is performed afterward and uses the same total mass fluxes as momentum advection. A time-split scheme is most often used where momentum and potential temperature are updated more frequently than other scalar fields in order to accommodate horizontally propagating sound waves.

Tempest uses the ARS(2,3,2) scheme described in \cite{ascher1997implicit}, with all horizontal and vertical advection terms treated explicitly and the remaining vertical terms, associated with sound wave propagation, treated implicitly.


\subsection{The FVM Semi-Implicit method} \label{sec:FVMSemiImplicit}

A characteristic feature of the FVM (Section~\ref{sec:FVM}) time-stepping scheme is the 3D implicit treatment 
of the fast buoyant and acoustic modes, and the slow rotational modes. Therefore, the model time step is 
identical for all processes and selected according to the stability of the advective transport scheme---i.e.~%
the time step is continuously adapted according to a given maximum advective Courant number 
permitted by the MPDATA scheme.
A comprehensive discussion of the integration scheme can be found in \cite{smolarkiewiczJCP2014,smolarkiewiczetalJCP2016,kuehnleinJCP2017} for dry dynamics, 
and in \cite{kurowskiJAS2014,smolarkiewiczetalJCP2017} for moist-precipitating dynamics. Here,
we provide an outline of the basic integration scheme for the compressible Euler equations
\eqref{fvm:compressible}. The scheme employs the two-time-level second-order-accurate template 
algorithm given as
\begin{equation}
\psi_{\mbf{i}}^{n+1}= \mathcal{A}_{\mbf{i}}(\widetilde{\psi}^{n},\mathbf{V}^{n+1/2}, (\mathcal{G}\rho_d)^{n}, (\mathcal{G}\rho_d)^{n+1})
+0.5\,\Delta t\,R^{\psi}|_{\mbf{i}}^{\scs n+1}~,
\hspace{1em} \widetilde{\psi}^{n}\,\equiv\,\psi^n+0.5\,\Delta t\,R^{\psi}|^{\scs n}~.
\label{fvm:solscalar}
\end{equation}
where $\psi$ represents the solution variable, $R^{\psi}$ is the respective rhs,
$\mathcal{A}$ symbolises the advective transport operator---the non-oscillatory 
finite-volume MPDATA bespoke for the compressible dynamics on the hybrid horizontally-unstructured
vertically-structured mesh \citep{kuehnleinJCP2017}---and the vector index $\mathbf{i} \equiv (k,i)$ denotes the 
spatial position on the computational mesh.

The integration of the system \eqref{fvm:compressible} can basically be divided into three steps. First, the homogenous
mass continuity equation is integrated with $\psi \equiv \rho_d$, $\mathbf{V} \equiv \mathbf{v}\mathcal{G} $,
and $R^{\rho_d} \equiv 0$ in \eqref{fvm:solscalar}. Second, the thermodynamic \eqref{fvm:thermodynamic}, 
momentum \eqref{fvm:momentum}, and moisture equations enter
\eqref{fvm:solscalar} with $\psi = u, v, w, \theta',...$, $\mathbf{V} \equiv \mathbf{v}\mathcal{G}\rho_d$, and the rhs $R^{\psi}$ 
which is generally depending on all prognostic variables. The high degree of implicitness in the representation of the rhs forcings
is achieved by inverting the overall discrete system \eqref{fvm:solscalar} to obtain closed-form expressions for the
velocity updates---the procedure is facilitated by the co-located arrangement of all variables on the computational mesh.
Retained on the rhs of the derived closed-form velocity expressions is the pressure gradient term.
The subsequent third step in the solution procedure is to formulate an implicit boundary value problem for the pressure variable $\phi'$ using 
an advective form of the equation of state \eqref{fvm:gaslaw}. An $\mathcal{O}(\Delta t^2)$ integration of this 
equation with a Euler backward scheme, in the spirit of \eqref{fvm:solscalar}, leads a Helmholtz equation
\citep{smolarkiewiczJCP2014}.
The associated 3D elliptic boundary value problem is solved iteratively using a preconditioned Generalised Conjugate 
Residual approach; see \cite{smolarkiewiczAG2011} and references therein. Nonlinear terms in $R^{\psi}|^{\scs n+1}$ and the 
solution-dependent coefficients of the Helmholtz equation are lagged behind and executed in an outer iteration.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection {A semi-Lagrangian implicit time discretization in the GEM model} \label{sec:GEM_temporal}

GEM differs from the approaches above by using a semi-Lagrangian advection.
Any model equations, prognostic or diagnostic, are written in the form
\begin{align}
\frac {dF}{dt}+G=0,
\label{eq:gem_temporal_O}
\end{align}
\noindent where $\frac{d}{dt}$ is the Lagrangian derivative, $F$ containing the terms subject to this operator, $G$ the remaining terms.
The semi-Lagrangian approach consists in the following space-time discretization of (\ref{eq:gem_temporal_O})
\begin{align}
\frac{F^A-F^{D}} {\Delta t}+ \left( \frac{1}{2} + \epsilon \right)G^A + \left( \frac{1}{2} - \epsilon\right )G^D = 0,
\label{eq:gem_temporal_D}
\end{align}
where $A$ stands for the arrival position at model grid point $(\vb{r}_h, \zeta, t)$
and $D$ for the departure position $(\vb{r}_h-\Delta\vb{r}_h, \zeta-\Delta \zeta, t-\Delta t)$
due to the displacements $\Delta\vb{r}_h, \Delta \zeta$
having occurred during the timestep $\Delta t$.
$G$ is averaged between these two positions with a possible slight off-centering $\epsilon$.
The displacements are themselves calculated solving, again using the Lagrangian method, the equations:
\begin{align}
\frac {d\vb{r}_h}{dt} - \vb{u}_h = 0 ; \frac {d\zeta}{dt} - \dot{\zeta} = 0,
\label{eq:gem_temporal_d_O}
\end{align}
discretized in the same way (trapezoidal method) though without off-centering:
\begin{align}
\frac{\Delta \vb{r}_h}{\Delta t} - \frac{ {\vb{u}_h}^A + {\vb{u}_h}^D }{2} = 0;
\frac{\Delta \zeta}{\Delta t} - \frac{\dot{\zeta}^A + \dot{\zeta}^D}{2} = 0.
\label{eq:gem_temporal_d_D}
\end{align}

\noindent The process is of course a {\it{multi-step iterative}}
one
since both positions and velocities at departure positions (past time $t-\Delta t$)
are unknown as well as, of course, the velocities at arrival positions (time $t$).
Once a first estimate of the departure positions is obtained,
the model equations are solved to obtain a first estimate of the velocities at time $t$.
The model equations must be solved simultaneously and this is only possible for the linear part $L$
which becomes a {\it {matrix inversion problem}}.
Hence a suitable linearization is considered. The unknown (arrival) linear $L$ and non-linear $N$
parts are then separated from the known (first departure estimate) remaining $R$ part.
Thus, first separating space-times, (\ref{eq:gem_temporal_D}) is rewritten as follows
\begin{align}
\frac{F^A} {\tau} + G^A =  \frac{F^{D}} {\tau}- \beta G ^{D} \equiv R^{D},
\label{eq:gem_temporal_AD}
\end{align}
where $\tau = \left ( 1/2 + \epsilon\right)\Delta t$ and $\beta=\left ( 1/2 - \epsilon\right)/\left ( 1/2 + \epsilon\right)$.
Second separating linear from non-linear parts, we get:
\begin{align}
L^A + N^A = R^D,
\label{eq:gem_temporal_LN}
\end{align}
\noindent
with
\begin{align}
L^A=\left[\frac{F^A}{\tau} + G^A \right]_{linear}, \quad and \quad N^A \equiv \frac{F^A}{\tau} + G^A  - \left[\frac{F^A}{\tau} + G^A \right]_{linear}.
\end{align}
Note that both $F$ and $G$ may require linearization. $L^A$ may then be obtained if $N^A$ is first guessed:
Once $L^A$ is found, an estimate of $N^A$ is obtained and $L^A$ is recalculated.
This is called the {\it{non-linear iteration process}}
(one iteration is usually sufficient).
The overall process is then repeated once starting from a new estimate of the departure positions.

There are two intensive calculation sections in this process:
the so-called semi-Lagrangian calculations
(twice estimating departure positions, twice interpolating right-hand sides $R$ on departure positions),
and solution of the linear system (four times).
Each time, the linear system is reduced to a Helmholtz problem for one composite variable.
For this problem, a direct solver is involved, using the Schwarz-type domain decomposition method on a Yin-Yang grid
\citep{Qaddouri2008schwarz}.
The composite variable solution is then used to update the prognostic variables (back substitution).
At the end of the time-step, the static halo region of both panels of the Yin-Yang grid is updated \citep{Qaddouri2011operational}.
All required interpolations throughout the semi-Lagrangian process and between Yin and Yang grids are cubic interpolations.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\conclusions[Summary and Conclusions] \label{sec:Conclusions}  %% \conclusions[modified heading if necessary]

As discussed earlier, this paper represents the first in a series of papers documenting the results from the 2016 Dynamical Core Model Intercomparison Project workshop and summer school.  In this paper we have provided a description of the differences and similarities between participating models, including the choice of computational grid, horizontal staggering, vertical staggering, vertical coordinates, prognostic equations, choice of diffusion, stabilization, filters and fixers, and temporal discretization.  The literature on dynamical core development is vast, with origins that go back over half a century.  Consequently, the models discussed in this paper only represent a sample of the many dynamical cores that have been developed for general circulation modeling.  Some of the models that have not been discussed include \cite{fox1997finite, prusa2008eulag, nair2009computational, baba2010dynamical, donner2011dynamical, ullrich2012mcore, gassmann2013global, wood2014inherently} and \cite{doyle2014next}.

The vast diversity of the modern dynamical core ecosystem suggests that there is no consensus on a single approach that is intrinsically superior to other options.  Choices made in the dynamical core confer advantages that include parallel scalability \citep{dennis2012cam}, conservation of invariants \citep{thuburn2008some}, or representation of the Kinetic energy spectrum \citep{skamarock2004evaluating}.  The repercussions that emerge from these choices can then be explored in the context of idealized test cases, such as the ones that have been proposed as part of DCMIP.  The remaining papers in this series investigate how the models described in this paper are able to simulate three idealized test cases, which each incorporate simplified model physics:  a moist baroclinic wave, an idealized tropical cyclone, and a splitting supercell storm on a small planet.  Where appropriate, metrics have been included that may be indicative of model performance.  These tests can also be used for future dynamical core development to identify where a new dynamical core diverges from a suite of modern models.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

\section{Moist Non-hydrostatic Equation Sets} \label{sec:EquationSets}

%This section provides an overview of the shared notation adopted by DCMIP for describing the equations and discretizations that have been adopted by the dynamical cores involved in this project.  Table \ref{tab:symbols} lists the symbols used in this paper.  %Great circle distance is used throughout the project and is computed via
%\begin{equation}
%R_c(\lambda_1, \varphi_1; \lambda_2, \varphi_2) = a \arccos \left( \sin \varphi_1 \sin \varphi_2 + \cos \varphi_1 \cos \varphi_2 \cos (\lambda_1 - \lambda_2) \right).
%\end{equation}

In this appendix we provide a detailed derivation of the fluid equations utilized by non-hydrostatic models.  The physical constants which are used throughout this document is given in Table \ref{tab:PhysicalConstants}.  The material derivative is used for  quantities in the Lagrangian frame (following individual air parcels), and is given by
\begin{align}
\diff{}{t} = \pdiff{}{t} + \vb{u} \cdot \nabla,
\end{align} where $\vb{u}$ denotes the 3D vector velocity.  Note that tracer variables $q_i$, including specific humidity $q$, satisfy the simple Lagrangian relationship
\begin{align} \label{eq:TracerTransport}
\diff{q_i}{t} = 0.
\end{align}  

\begin{table}[h]
\caption{A list of physical constants used in this document.} \label{tab:PhysicalConstants}
%\ \\
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}}lll}
\hline Constant & Description & Value \\
\hline $a_{\tiny \mbox{ref}}$ & Radius of the Earth & $6.37122 \times 10^{6}\ \mbox{m}$ \\
$\Omega_{\tiny \mbox{ref}}$ & Rotational speed of the Earth & $7.292\ \times 10^{-5}\ \mbox{s}^{-1}$ \\
%$a$ & Scaled radius of the Earth & $a_{\tiny \mbox{ref}} / X$ \\
%$\Omega$ & Scaled rotational speed of the Earth & $\Omega_{\tiny \mbox{ref}} \cdot X$ \\
$g_c$ & Gravitational acceleration & $9.80616\ \mbox{m}\ \mbox{s}^{-2}$ \\
$p_0$ & Reference pressure & $1000\ \mbox{hPa}$ \\
$c_{pd}$ & Specific heat capacity of dry air at constant pressure & $1004.5\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$c_{pw}$ & Specific heat capacity of water vapor at constant pressure & $1930.0\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$c_{vd}$ & Specific heat capacity of dry air at constant volume & $717.5\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$c_{vw}$ & Specific heat capacity of water vapor at constant volume & $1460.0\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$R_d$ & Gas constant for dry air & $287.0\ \mbox{J}\ \mbox{kg}^{-1}\ \mbox{K}^{-1}$ \\
$R_w$ & Gas constant for water vapor & $461.5$ J kg$^{-1}$ K$^{-1}$ \\
%$\kappa$ & Ratio of $R_d$ to $c_p$ & $2/7$ \\
$\varepsilon$ & Ratio of $R_d$ to $R_w$ & $0.622$ \\
$M_v$ & Constant for virtual temperature conversion & $0.608$ \\
$\rho_{water}$ & Reference density of water & 1000 kg m$^{-3}$ \\
\hline 
\end{tabular*}
\end{table}

\subsection{Diagnostic relationships}

The atmospheric fluid is assumed to be an ideal gas.  For moist air, the ideal gas constant $R^\ast$, specific heat capacity at constant pressure $c_p^\ast$ and specific heat capacity at constant volume $c_v^\ast$ are given by
\begin{align}
R^\ast =& R_d + (R_w - R_d) q, & c_p^\ast =& c_{pd} + (c_{pw} - c_{pd}) q, & c_v^\ast =& c_{vd} + (c_{vw} - c_{vd}) q.
\end{align}  Note that in many models, $R^\ast$, $c_p^\ast$ and $c_v^\ast$ are approximated by $R_d$, $c_{pd}$ and $c_{vd}$, respectively.  Dry air, water vapor and moist air quantities all satisfy the linear relationship $R = c_p - c_v$.  For a two-fluid system (dry air plus water vapor), two independent variables plus the specific humidity $q$ are needed to describe the thermodynamic state of the system.  Key thermodynamic variables include dry air density $\rho_d$, moist density $\rho$, pressure $p$, vapor pressure $e$, temperature $T$, virtual temperature $T_v$, Exner pressure $\pi$, potential temperature $\theta$, and virtual potential temperature $\theta_v$.  Common ratios $\kappa = R^\ast / c_p^\ast$, $\varepsilon = R_d / R_w$, and $\gamma = c_p^\ast / c_v^\ast$ are adopted here.

Relationships between key thermodynamic variables arise from the ideal gas law, along with definitions of Exner pressure, potential temperature and virtual potential temperature
\begin{align} \label{eq:DiagnosticRelationships1}
p =& \rho R_d T_v, & \pi =& \left( \frac{p}{p_0} \right)^{\kappa}, & \theta =& T \left( \frac{p_0}{p} \right)^{\kappa}, & \theta_v =& T_v \left( \frac{p_0}{p} \right)^{\kappa},
\end{align}  which further give rise to
\begin{align}
p =& \left( \frac{\rho R_d \theta_v}{p_0^\kappa} \right)^{\gamma}, & \pi =& \left( \frac{\rho R_d \theta_v}{p_0} \right)^{R^\ast / c_v^\ast}, & \theta =& \frac{T}{\pi}, & \theta_v =& \frac{T_v}{\pi}.
\end{align}

Note that virtual temperature is typically approximated by
\begin{align}
T_v \approx& T \left(1 + \frac{(1-\varepsilon)}{\varepsilon} q \right),
\end{align} which arises from the exact relationship
\begin{align}
T_v = \frac{T}{1 - \frac{e}{p} (1 - \varepsilon)},
\end{align} upon applying $e/p = q / \varepsilon$ and using a Taylor expansion around $q = 0$.

\subsection{Prognostic equations for thermodynamic variables}

Note that, as a consequence of (\ref{eq:TracerTransport}), the following simplifications can be applied:
\begin{align}
\frac{1}{T_v} \diff{T_v}{t} =& \frac{1}{T} \diff{T}{t}, & \diff{R^\ast}{t} =& 0, & \diff{c_p^\ast}{t} =& 0, & \diff{c_v^\ast}{t} =& 0.
\end{align}

Mass conservation is typically represented through the continuity equation, which can be written in the Lagrangian frame as
\begin{align} \label{eq:ContinuityEquation}
\diff{\rho}{t} =& - \rho \nabla \cdot \vb{u},
\end{align} or equivalently in the Eulerian frame,
\begin{align} \label{eq:EulerianContinuityEquation}
\pdiff{\rho}{t} =& - \nabla \cdot (\rho \vb{u}).
\end{align}

Further prognostic relationships can be derived from the thermodynamic equation, including the diabatic heating rate $J$,
\begin{align}
\frac{1}{T} \diff{T}{t} - \frac{\kappa}{p} \diff{p}{t} =& \frac{J}{c_p^\ast},
\end{align} which can be alternatively written as
\begin{align} \label{eq:PotentialTemperaturePrognostic}
\diff{\theta}{t} = \frac{J \theta}{c_p^\ast}, \quad \mbox{or} \quad \diff{\theta_v}{t} = \frac{J \theta_v}{c_p^\ast}.
\end{align}  These equations can then be combined with (\ref{eq:ContinuityEquation}) to obtain
\begin{align} \label{eq:PotentialTemperatureFluxForm}
\pdiff{}{t} (\rho \theta_v) + \nabla \cdot (\rho \theta_v \vb{u}) = \frac{J \rho \theta_v}{c_p^\ast},
\end{align} or similarly for $\theta$.  In conjunction with the material derivative of the ideal gas law,  
\begin{align}
\frac{1}{p} \diff{p}{t} = \frac{1}{\rho} \diff{\rho}{t} + \frac{1}{T_v} \diff{T_v}{t},
\end{align} the thermodynamic equation can be written in the form
\begin{align}
\frac{c_v^\ast}{R^\ast T_v} \diff{T_v}{t} - \frac{1}{\rho} \diff{\rho}{t} = \frac{J}{R^\ast}.
\end{align}  Then substituting (\ref{eq:ContinuityEquation}) gives a prognostic equation for virtual temperature,
\begin{align} \label{eq:VirtualTemperaturePrognosticEq}
\frac{c_v^\ast}{R^\ast} \diff{T_v}{t} + T_v \nabla \cdot \vb{u} = \frac{J T_v}{R^\ast}.
\end{align}  The prognostic equation for temperature is identical except with $T$ substituted for $T_v$.  An analogous equations for pressure can be obtained through a similar procedure,
\begin{align} \label{eq:PressurePrognosticEq}
\frac{c_v^\ast}{c_p^\ast} \diff{p}{t} + p \nabla \cdot \vb{u} = \frac{J p}{c_p^\ast}.
\end{align}  And similarly for Exner pressure,
\begin{align}
\frac{c_v^\ast}{R^\ast} \diff{\pi}{t} + \pi \nabla \cdot \vb{u} = \frac{J \pi}{c_p^\ast}.
\end{align}


\subsection{Momentum Equations}

In coordinate-invariant form the prognostic velocity equations may be written in either the Lagrangian or Eulerian frame as
\begin{align} \label{eq:PrognosticVelocity1}
\diff{\vb{u}}{t} = \pdiff{\vb{u}}{t} + \vb{u} \cdot \nabla \vb{u} = - \frac{1}{\rho} \nabla p - 2 \vg{\Omega} \times \vb{u} - \nabla \Phi,
\end{align} where $\vg{\Omega}$ denotes the planetary vorticity vector and $\Phi$ is the geopotential function.  The three terms on the right-hand-side of this expression correspond to pressure gradient, Coriolis, and gravitational force, respectively.  In Eulerian form one must be careful with the treatment of the momentum advection term $\vb{u} \cdot \nabla \vb{u}$, since in an arbitrary coordinate frame this term will give rise to Christoffel symbols associated with derivatives of the vector basis.  Note that it is common to rewrite the pressure gradient force using the relationship
\begin{align}
- \frac{1}{\rho} \nabla p = - \frac{R_d c_p^\ast}{R^\ast} \theta_v \nabla \pi,
\end{align} which follows from (\ref{eq:DiagnosticRelationships1}).  A second form of (\ref{eq:PrognosticVelocity1}) emerges on substituting the vector calculus identity
\begin{align}
\vb{u} \cdot \nabla \vb{u} =& \nabla K + \vg{\zeta} \times \vb{u},
\end{align} where $K = \frac{1}{2} (\vb{u} \cdot \vb{u})$ is the 3D Kinetic energy and $\vg{\zeta} = \nabla \times \vb{u}$ is the 3D relative vorticity vector.  This gives rise to the 3D vector-invariant form,
\begin{align} \label{eq:PrognosticVelocity2}
\pdiff{\vb{u}}{t} = - \frac{1}{\rho} \nabla p - \nabla (K + \Phi) - (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u}. 
\end{align}  Because no gradients of vectors appear in this equation, it avoids derivatives of the coordinate basis  that would arise from the momentum transport term $\vb{u} \cdot \nabla \vb{u}$ in (\ref{eq:PrognosticVelocity1}).  In conjunction with (\ref{eq:ContinuityEquation}), (\ref{eq:PrognosticVelocity1}) also gives rise to the flux-form momentum equations,
\begin{align} \label{eq:PrognosticVelocityFluxForm}
\pdiff{}{t} (\rho \vb{u}) = - \nabla \cdot (\vb{u} \otimes \vb{u} + \mathcal{I} p) - 2 \vg{\Omega} \times (\rho \vb{u}) - \rho \nabla \Phi,
\end{align} where $\vb{u} \otimes \vb{u}$ denotes the outer product and $\mathcal{I}$ is the identity matrix.

%Finally, a prognostic equation for geopotential follows directly from the material derivative,
%\begin{align} \label{eq:Geopotential}
%\diff{\Phi}{t} = \vb{u} \cdot \nabla \Phi.
%\end{align}

The equations above still provide some flexibility with regards to the choice of $\Phi$ and $\vg{\Omega}$.  For \textit{deep atmosphere} models, one typically chooses
\begin{align} \label{eq:DeepAtmosphereGeopotential}
\Phi = g a^2 \left[\frac{1}{a} - \frac{1}{a+z}\right], \quad \mbox{and} \quad \vg{\Omega} = \Omega ( \vb{k} \sin \varphi + \vb{j} \cos \varphi),
\end{align} where $g$ is gravitational acceleration at the surface, $a$ is the radius of the planet, $\Omega$ is the rotation rate (in s$^{-1}$), $\varphi$ is the latitude, $\vb{j}$ is the unit vector oriented in the meridional direction, and $\vb{k}$ is the unit vector oriented in the vertical direction.  For models that don't utilize a height-based vertical coordinate, the geopotential is generally treated as a prognostic variable, with an evolution equation that emerges from the definition $w = dz/dt$,
\begin{align}
\diff{\Phi}{t} = \frac{a^2 g w}{(a + z)^2}.
\end{align}  For \textit{shallow atmosphere} models, the geopotential takes the simpler form
\begin{align} \label{eq:ShallowAtmosphereGeopotential}
\Phi = g z, \quad \mbox{and} \quad \vg{\Omega} = \Omega \sin \varphi \vb{k},
\end{align} where $z$ is the altitude above the surface.  In this case we write $2 \vg{\Omega} = f \vb{k}$, where $f = 2 \Omega \sin \varphi$ is the Coriolis parameter.  The evolution equation for the shallow atmosphere geopotential is then
\begin{align} \label{eq:PrognosticShallowGeopotential}
\diff{\Phi}{t} = g w.
\end{align}

\subsection{Orthogonal Formulation}

Under the orthogonal formulation, projection of a vector field $\vb{b}$ onto its horizontal components is defined via
\begin{align}
[\vb{b}]_z = \vb{b} - (\vb{b} \cdot \vb{k}) \vb{k}.
\end{align}  When applied to the velocity vector this gives rise to the decomposition
\begin{align}
\vb{u} = \vb{u}_h + w \vb{k},
\end{align} where $\vb{k} = \nabla z$ is the unit vector in the vertical direction and $\vb{u}_h = [\vb{u}]_z$ ($\vb{u}_h$ is aligned with surfaces of constant $z$).  In the orthogonal formulation, the material derivative expands as
\begin{align} \label{eq:MaterialDerivative}
\diff{}{t} = \pdiff{}{t} + \vb{u}_h \cdot \nabla + w \vb{k} \cdot \nabla.
\end{align}  For the special case of the material derivative applied to scalars, this equation can also be written as
\begin{align} \label{eq:MaterialDerivativeScalar}
\diff{}{t} = \pdiff{}{t} + \vb{u}_h \cdot \nabla_z + w \pdiff{}{z}.
\end{align} where $\nabla_z b = [\nabla b]_z$ denotes the gradient along constant $z$ surfaces.  From here, the vector-invariant form velocity equation obtained by taking (\ref{eq:PrognosticVelocity2}) $\cdot \vb{k}$ expands as
\begin{align} \label{eq:VerticalVelocityOrthogonal}
\pdiff{w}{t} =& - \frac{1}{\rho} \pdiff{p}{z} - \pdiff{}{z} (K + \Phi) - \left[ (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u} \right] \cdot \vb{k},
\end{align} which, from $\vb{u}_h = \vb{u} - w \vb{k}$, then gives rise to
\begin{align} \label{eq:HorizontalVelocityOrthogonal}
\pdiff{\vb{u}_h}{t} =& - \frac{1}{\rho} \nabla_z p - \nabla_z (K + \Phi) - \left[ (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u} \right]_z.\end{align}

%{\color{red}[Using $K = K_2 + w^2/2$ does this give rise to a simpler version of the $K_2$ evolution equations?]}

Due to its association with hydrostatic models, it is common to use the 2D Kinetic energy, $K_2 = \frac{1}{2} (\vb{u}_h \cdot \vb{u}_h)$.  Decomposing the momentum transport term into horizontal and vertical components gives
\begin{align}
\vb{u} \cdot \nabla \vb{u} =& \vb{u}_h \cdot \nabla \vb{u}_h + (\nabla \times \vb{u}_h) \times (w \vb{k}) + (\vb{u} \cdot \nabla w) \vb{k}.
\end{align}  The first term in this expression admits the relationships
\begin{align}
\left[ \vb{u}_h \cdot \nabla \vb{u}_h \right]_z =& \nabla_z K_2 + \zeta_h \vb{k} \times \vb{u}_h, \label{eq:UhDotNablaUhRelationship1} \\
(\vb{u}_h \cdot \nabla \vb{u}_h) \cdot \vb{k} =& - \vb{u}_h \cdot (\vb{u}_h \cdot \nabla \vb{k}) = - K_2 (\nabla \cdot \vb{k}) - \tfrac{1}{2} \left[ \vb{u}_h \cdot (\nabla \times \vb{u}_t)  + (\nabla \times \vb{u}_h) \cdot \vb{u}_t \right] \label{eq:UhDotNablaUhRelationship2}
\end{align} where $\zeta_h = (\nabla \times \vb{u}) \cdot \vb{k} = (\nabla \times \vb{u}_h) \cdot \vb{k}$ is the relative vorticity scalar and $\vb{u}_t = \vb{k} \times \vb{u}_h$.  Note that this equation does incorporate metric terms associated with horizontal advection of $\vb{k}$ which must be accounted for.

Thus the vertical velocity equation, obtained by taking (\ref{eq:PrognosticVelocity1})$\cdot \vb{k}$, is
\begin{align} \label{eq:PrognosticWEquationK2}
\pdiff{w}{t} =& \vb{u}_h \cdot (\vb{u}_h \cdot \nabla \vb{k}) - w \pdiff{w}{z} - \vb{u}_h \cdot \nabla_z w - \pdiff{\Phi}{z} - \frac{1}{\rho} \pdiff{p}{z} - (2 \vg{\Omega} \times \vb{u}_h) \cdot \vb{k}.
\end{align}  Then subtracting (\ref{eq:PrognosticWEquationK2})$\cdot \vb{k}$ from (\ref{eq:PrognosticVelocity1}) gives
\begin{align} \label{eq:PrognosticUhEquationK2}
\pdiff{\vb{u}_h}{t} =& - w (\vb{u}_h \cdot \nabla \vb{k}) - w \pdiff{\vb{u}_h}{z} - \nabla_z (K_2 + \Phi) - \frac{1}{\rho} \nabla_z p - \zeta_h \vb{k} \times \vb{u}_h - [2 \vg{\Omega} \times \vb{u}]_z.
\end{align}  Note that under the shallow atmosphere approximation, the metric term $\vb{u}_h \cdot (\vb{u}_h \cdot \nabla \vb{k})$ in (\ref{eq:PrognosticWEquationK2}) is set equal to zero in accordance with \cite{phillips1966equations}.

\subsection{Arbitrary vertical coordinates}

The dynamical equations are now formulated in terms of the vertical coordinate $s(t,\vb{x},z)$ with $\partial s / \partial z \neq 0$ everywhere, i.e. following \cite{kasahara1974various} (hereafter K74).  Since $\vb{x}$ and $t$ are shared between the two coordinate systems, the chain rule can be applied to obtain expressions
\begin{align} \label{eq:ChainRule}
\pdiff{}{z} =& \pdiff{s}{z} \pdiff{}{s}, & \nabla_s =& \nabla_z + (\nabla_s z) (\vb{k} \cdot \nabla), & \left( \pdiff{}{t} \right)_s =& \pdiff{}{t} + \left( \pdiff{z}{t} \right)_s (\vb{k} \cdot \nabla),
\end{align} which correspond to derivatives in the vertical, in the horizontal and in time.  This final expression is used to describe the rate of change of a quantity on $s$ surfaces.  These operators then yield the useful identities
\begin{align} \label{eq:NablaZSIdentity}
\pdiff{s}{z} =& \left( \pdiff{z}{s} \right)^{-1}, & \nabla_z s =& - \left( \pdiff{s}{z} \right) \nabla_s z, & \pdiff{s}{t} =& - \pdiff{s}{z} \left( \pdiff{z}{t} \right)_s.
\end{align}  From here (\ref{eq:ChainRule}) also gives rise to
\begin{align} \label{eq:HorizontalChainRule}
\nabla_z = \nabla_s - \pdiff{s}{z} (\nabla_s z) \pdiff{}{s},
\end{align} which can be used directly to rewrite (\ref{eq:HorizontalVelocityOrthogonal}) or (\ref{eq:PrognosticUhEquationK2}) in terms of derivatives over $s$.  Note that the operators $\nabla_z$ and $\nabla_s$ are usually introduced in the context of 2D flows, however the construction described here has the advantage of working seamlessly in a 3D context, while admitting the properties $\vb{k} \cdot \nabla_z A = 0$ and $\vb{k} \cdot \nabla_s A = 0$ for any scalar field $A$.

From (\ref{eq:ChainRule}), it can be shown that the 2D divergence on $s$ surfaces (given by K74 eq. (3.17)) is
\begin{align} \label{eq:DivergenceS}
\nabla_s \cdot \vb{u}_h = \nabla_z \cdot \vb{u}_h + \left( \pdiff{s}{z} \right) (\nabla_s z) \cdot \left( \pdiff{\vb{u}_h}{s} \right),
\end{align} and that the 2D curl is given by
\begin{align} \label{eq:CurlS}
\nabla_s \times \vb{u}_h = \nabla_z \times \vb{u}_h + \left( \pdiff{s}{z} \right) (\nabla_s z) \times \left( \pdiff{\vb{u}_h}{s} \right),
\end{align} where $\nabla_z \times \vb{u}_h = \vb{k} (\vb{k} \cdot (\nabla \times \vb{u}_h))$.  Notably, these expressions are valid for both shallow- and deep-atmosphere formulations.

The generalized velocity $\dot{s}$ following a fluid parcel is defined by
\begin{align} \label{eq:DefinitionDotS}
\dot{s} \equiv \diff{s}{t} = \pdiff{s}{t} + \vb{u} \cdot \nabla s = \vb{u}_h \cdot \nabla_z s + \left[ w - \left( \pdiff{z}{t} \right)_s \right] \pdiff{s}{z}.
\end{align}  Then using (\ref{eq:ChainRule}) and (\ref{eq:DefinitionDotS}) to rewrite (\ref{eq:MaterialDerivativeScalar}) gives an expression for the material derivative for scalars on $s$ surfaces,
\begin{align}
\diff{A}{t} =& \left( \pdiff{A}{t} \right)_s - \pdiff{s}{z} \left( \pdiff{z}{t} \right)_s \pdiff{A}{s} + \vb{u}_h \cdot \left[ \nabla_s A + (\nabla_z s) \pdiff{A}{s} \right] + w \pdiff{s}{z} \pdiff{A}{s} \\
=& \left( \pdiff{A}{t} \right)_s  + \vb{u}_h \cdot \nabla_s A + \dot{s} \pdiff{A}{s}  \label{eq:MaterialDerivativeS}
\end{align}  A similar expression arises for vectors, although in this case $\vb{u}_h \cdot \nabla \vb{a} \neq \vb{u}_h \cdot \nabla_z \vb{a}$ implies we cannot use the operator $\nabla_s$ in the form (\ref{eq:ChainRule}), and instead obtain
\begin{align} \label{eq:MaterialDerivativeVectorS}
\diff{\vb{a}}{t} =& \left( \pdiff{\vb{a}}{t} \right)_s + \left[ \vb{u}_h \cdot \nabla \vb{a} + (\vb{u}_h \cdot \nabla_s z) (\vb{k} \cdot \nabla \vb{a}) \right] + \dot{s} \pdiff{\vb{a}}{s}.
\end{align}

%{\color{red}[Is this needed?]} Note that
%\begin{align}
%\nabla A = \nabla_z A + \vb{k} \pdiff{A}{z} = \nabla_s A - \pdiff{s}{z} (\nabla_s z) \pdiff{A}{s} + \vb{k} \pdiff{s}{z} \pdiff{A}{s} = \nabla_s A + ( \vb{k} - \nabla_s z) \pdiff{s}{z} \pdiff{A}{s}
%\end{align}

\subsection{Conservation Laws in Arbitrary Vertical Coordinates}

Using (\ref{eq:DivergenceS}), we observe that the 3D divergence on the sphere takes the form
\begin{align} \label{eq:ThreeDDivergence}
\nabla \cdot \vb{u} = \nabla_z \cdot \vb{u}_h + \frac{1}{\alpha} \pdiff{}{z} (\alpha w),
\end{align} where $\alpha = 1$ for shallow-atmosphere models and $\alpha = r^2 = (a + z)^2$ for deep-atmosphere models.  Using $w = dz/dt$, this last term also takes the form
\begin{align} \label{eq:GeneralVerticalTermX}
\frac{1}{\alpha} \pdiff{}{z} (\alpha w) = \pdiff{w}{z} + \frac{w}{\alpha} \pdiff{\alpha}{z} = \pdiff{w}{z} + \frac{1}{\alpha} \diff{\alpha}{t}.
\end{align}

Using (\ref{eq:NablaZSIdentity}) to rewrite (\ref{eq:DefinitionDotS}) gives rise to
\begin{align}
w = \left( \pdiff{z}{t} \right)_s + \vb{u}_h \cdot \nabla_s z + \dot{s} \left( \pdiff{s}{z} \right)^{-1},
\end{align} which is then differentiated to yield K74 eq. (3.16),
\begin{align} \label{eq:WDerivativeS}
\pdiff{w}{z} = \left( \pdiff{s}{z} \right) \left[ \diff{}{t} \left( \pdiff{s}{z} \right)^{-1} + \left( \pdiff{\vb{u}_h}{s} \right) \cdot (\nabla_s z) \right] + \pdiff{\dot{s}}{s} = 0.
\end{align}  Substituting this expression into the continuity equation (\ref{eq:ContinuityEquation}), and using (\ref{eq:ThreeDDivergence}), (\ref{eq:GeneralVerticalTermX}), and (\ref{eq:WDerivativeS}) then leads to
\begin{align}
\diff{}{t} \left[ \alpha \left( \pdiff{s}{z} \right)^{-1} \rho \right] + \alpha \left( \pdiff{s}{z} \right)^{-1} \rho \left[ \nabla_z \cdot \vb{u}_h + \left( \pdiff{s}{z} \right) \left( \pdiff{\vb{u}_h}{s} \right) \cdot (\nabla_s z) \right] + \alpha \left( \pdiff{s}{z} \right)^{-1} \rho \pdiff{\dot{s}}{s} = 0.
\end{align}  Defining the \textit{pseudodensity} as 
\begin{align}
\rho_s = \alpha \left( \pdiff{s}{z} \right)^{-1} \rho,
\end{align} and using (\ref{eq:MaterialDerivativeS}) in the form
\begin{align}
\diff{\rho_s}{t} = \left( \pdiff{\rho_s}{t} \right)_s + \vb{u}_h \cdot \nabla_s \rho_s + \dot{s} \pdiff{\rho_s}{s},
\end{align} along with (\ref{eq:DivergenceS}) leads to
\begin{align} \label{eq:PrognosticPseudoDensity}
\left( \pdiff{\rho_s}{t} \right)_s + \nabla_s \cdot (\rho_s \vb{u}_h) + \pdiff{}{s} (\rho_s \dot{s}) = 0.
\end{align}

Hence for any quantity that is conserved following a fluid parcel (\textit{i.e.}, $dq/dt = 0$),
\begin{align}
\left( \pdiff{\rho_s q}{t} \right)_s + \nabla_s \cdot (\rho_s q \vb{u}_h) + \pdiff{}{s} (\rho_s q \dot{s}) = 0.
\end{align}  In particular, the prognostic equation for virtual potential temperature (or equivalently for potential temperature) reads
\begin{align} \label{eq:PrognosticPseudoDensityTheta}
\left( \pdiff{\rho_s \theta_v}{t} \right)_s + \nabla_s \cdot (\rho_s \theta_v \vb{u}_h) + \pdiff{}{s} (\rho_s \theta_v \dot{s}) = \frac{J \rho_s \theta_v}{c_p^\ast}.
\end{align}

\subsection{2D Vector Invariant Form}

The prognostic equations utilizing horizontal kinetic energy $K_2$ in place of $K$ are derived by applying (\ref{eq:ChainRule}) to (\ref{eq:PrognosticWEquationK2}), yielding
\begin{align} \label{eq:PrognosticWEquationK2Sa}
\left( \pdiff{w}{t} \right)_s =& \vb{u}_h \cdot (\vb{u}_h \cdot \nabla \vb{k}) - \vb{u}_h \cdot \nabla w + \left( \pdiff{s}{z} \right) \left\{ \left[ \left( \pdiff{z}{t} \right)_s - w \right] \pdiff{w}{s} - \pdiff{\Phi}{s} - \frac{1}{\rho} \pdiff{p}{s} \right\} - (2 \vg{\Omega} \times \vb{u}_h) \cdot \vb{k}.
\end{align}  Similarly, from (\ref{eq:PrognosticUhEquationK2}),
\begin{align} \label{eq:PrognosticUhEquationK2Sa}
\left( \pdiff{\vb{u}_h}{t} \right)_s =& - w (\vb{u}_h \cdot \nabla \vb{k}) + \left[ \left( \pdiff{z}{t} \right)_s - w \right] \left( \pdiff{s}{z} \right) \pdiff{\vb{u}_h}{s} - \zeta_h \vb{k} \times \vb{u}_h - \nabla_z (K_2 + \Phi) - \frac{1}{\rho} \nabla_z p - [2 \vg{\Omega} \times \vb{u}]_z.
\end{align}  Observe that both of these equations simplify when $w = (\partial z / \partial t)_s$, \textit{i.e.} model levels are advected with the vertical wind.

An alternative form of these equation can similarly be obtained in terms of $\dot{s}$.  Substituting (\ref{eq:DefinitionDotS}) into (\ref{eq:PrognosticWEquationK2Sa}) then gives
\begin{align} \label{eq:PrognosticWEquationK2Sb}
\left( \pdiff{w}{t} \right)_s =& \vb{u}_h \cdot (\vb{u}_h \cdot \nabla \vb{k}) - \vb{u}_h \cdot \nabla_s w - \dot{s} \pdiff{w}{s} + \left( \pdiff{s}{z} \right) \left[ - \pdiff{\Phi}{s} - \frac{1}{\rho} \pdiff{p}{s} \right] - (2 \vg{\Omega} \times \vb{u}_h) \cdot \vb{k}.
\end{align}  Similarly, substituting (\ref{eq:DefinitionDotS}) into (\ref{eq:PrognosticUhEquationK2Sa}) and using the identity
\begin{align}
(\vb{u}_h \cdot \nabla_s z) \left( \pdiff{s}{z} \right) \pdiff{\vb{u}_h}{s} = (\nabla_s \times \vb{u}_h) \times \vb{u}_h - \zeta_h \vb{k} \times \vb{u}_h + (\nabla_s z) \pdiff{K_2}{z}
\end{align}
 then gives
\begin{align} \label{eq:PrognosticUhEquationK2Sb}
\left( \pdiff{\vb{u}_h}{t} \right)_s =& - w (\vb{u}_h \cdot \nabla \vb{k}) - \nabla_s K_2 - \zeta_s \vb{k} \times \vb{u}_h - \dot{s} \pdiff{\vb{u}_h}{s} - \nabla_z \Phi - \frac{1}{\rho} \nabla_z p - [2 \vg{\Omega} \times \vb{u}]_z,
\end{align} where
\begin{align}
\nabla_s \times \vb{u}_h = \vb{k} \zeta_s, \quad \mbox{and} \quad \zeta_s = \vb{k} \cdot (\nabla_s \times \vb{u}_h).
\end{align}  In this case the vertical advection terms are removed when $\dot{s} = 0$, \textit{i.e.} the vertical coordinate is advected with the 3D wind $\vb{u}$.

Note that under the shallow-atmosphere approximation, the first metric terms (those that include $(\vb{u}_h \cdot \nabla \vb{k})$) in (\ref{eq:PrognosticWEquationK2Sa})-(\ref{eq:PrognosticUhEquationK2Sb}) are typically dropped.

\subsection{3D Vector Invariant Form}

From (\ref{eq:PrognosticVelocity2}) and (\ref{eq:ChainRule}) the evolution equation for the 3D velocity vector takes the form
%\begin{align}
%\pdiff{\vb{u}}{t} = - \frac{1}{\rho} \nabla p - \nabla (K + \Phi) - (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u}
%\end{align} we have
\begin{align}
\left( \pdiff{\vb{u}}{t} \right)_s = \left( \pdiff{z}{t} \right)_s (\vb{k} \cdot \nabla \vb{u}) - \nabla (K + \Phi) - \frac{1}{\rho} \nabla p - (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u}
\end{align}  Then taking the dot product of this expression with $\vb{k}$ gives
\begin{align} \label{eq:PrognosticWEquation}
\left(\pdiff{w}{t} \right)_s =& \left( \pdiff{s}{z} \right) \left[ \left( \pdiff{z}{t} \right)_s \pdiff{w}{s} - \pdiff{}{s} (K + \Phi) - \frac{1}{\rho} \pdiff{p}{s} \right] - \left[ (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u} \right] \cdot \vb{k}
\end{align} where we have used $\vb{k} \cdot (\vb{k} \cdot \nabla \vb{u}) = \vb{k} \cdot \nabla w$.
 Similarly, the prognostic equation for horizontal velocity from (\ref{eq:HorizontalVelocityOrthogonal}) is reformulated as
\begin{align} \label{eq:PrognosticUhEquationKS}
\left( \pdiff{\vb{u}_h}{t} \right)_s =& \left( \pdiff{z}{t} \right)_s \left( \pdiff{s}{z} \right) \pdiff{\vb{u}_h}{s} - \nabla_z (K + \Phi) - \frac{1}{\rho} \nabla_z p - \left[ (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u} \right]_z.
\end{align}  Note that the vorticity term in this expression can be simplified further using
\begin{align}
[(\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u}]_z = - (\zeta_h + \vb{k} \cdot 2 \vg{\Omega}) (\vb{u}_h \times \vb{k}) - w \vb{k} \times (\vg{\zeta} + 2 \vg{\Omega}),
\end{align} and
\begin{align}
- \vb{k} \times \vg{\zeta} =& \vb{k} \cdot \nabla \vb{u} - \nabla (\vb{k} \cdot \vb{u}) + \vb{u} \cdot \nabla \vb{k} = \pdiff{\vb{u}_h}{z} - \nabla_z w + \vb{u}_h \cdot \nabla \vb{k}.
\end{align}
%so that (\ref{eq:PrognosticUhEquationKS}) takes the form
%\begin{align}
%\left( \pdiff{\vb{u}_h}{t} \right)_s =& \left( \pdiff{z}{t} \right)_s \left( \pdiff{s}{z} \right) \pdiff{\vb{u}_h}{s} - \nabla_z (K + \Phi) - \frac{1}{\rho} \nabla_z p - \left[ 2 \vg{\Omega} \times \vb{u} \right]_z - \zeta_h (\vb{u}_h \times \vb{k}) + w \left[ \pdiff{\vb{u}_h}{z} - \nabla_z w + \vb{u}_h \cdot \nabla \vb{k} \right]
%\end{align}

\subsection{Covariant Component Formulation}

In conjunction with (\ref{eq:HorizontalChainRule}), the horizontal momentum equation (in 2D vector invariant form as  (\ref{eq:PrognosticUhEquationK2Sa}) or (\ref{eq:PrognosticUhEquationK2Sb}), or in 3D vector invariant form as (\ref{eq:PrognosticUhEquationKS})) with an arbitrary vertical coordinate gives rise to a two-term pressure gradient.  This can be avoided by prognosing the covariant components of the velocity in place of the physical velocity components.  We define a horizontal covariance operator by
\begin{align}
[\vb{b}]_s \equiv [\vb{b}]_z + (\nabla_s z) (\vb{k} \cdot \vb{b}).
\end{align} Applying this operator to the horizontal velocity gives
\begin{align}
\vb{v}_h \equiv [\vb{u}]_s = \vb{u}_h + (\nabla_s z) w.
\end{align}  For a time-dependent $s$ coordinate, we obtain the identity
\begin{align}
\left[ \pdiff{}{t} (\nabla_s z) \right]_s =& \nabla_s \left( \pdiff{z}{t} \right)_s,
\end{align} and so can write
\begin{align} \label{eq:CovariantExpansion}
\left( \pdiff{\vb{v}_h}{t} \right)_s =& \left( \pdiff{\vb{u}_h}{t} \right)_s + (\nabla_s z) \left( \pdiff{w}{t} \right)_s + w \nabla_s \left( \pdiff{z}{t} \right)_s.
\end{align}  Then using (\ref{eq:CovariantExpansion}), (\ref{eq:PrognosticWEquation}) and (\ref{eq:PrognosticUhEquationKS}) and identity
\begin{align}
& \left( \pdiff{z}{t} \right)_s \left( \pdiff{s}{z} \right) \left[ \pdiff{\vb{u}_h}{s} + (\nabla_s z) \pdiff{w}{s} \right] + w \nabla_s \left( \pdiff{z}{t} \right)_s \nonumber \\
& \qquad \qquad  = \left( \pdiff{s}{z} \right) \left( \pdiff{z}{t} \right)_s \left\{ \pdiff{\vb{v}_h}{s} - \nabla_s \left[ \left( \pdiff{s}{z} \right)^{-1} w \right] \right\} + \nabla_s \left[ \left( \pdiff{z}{t} \right)_s w \right]
\end{align} gives
\begin{align}
\left( \pdiff{\vb{v}_h}{t} \right)_s =& - \nabla_s \left[ K - w \left( \pdiff{z}{t} \right)_s + \Phi \right] - \frac{1}{\rho} \nabla_s p - \left[ (\vg{\zeta} + 2 \vg{\Omega}) \times \vb{u} \right]_s \\
& \qquad + \left( \pdiff{s}{z} \right) \left( \pdiff{z}{t} \right)_s \left\{ \pdiff{\vb{v}_h}{s} - \nabla_s \left[ \left( \pdiff{s}{z} \right)^{-1} w \right] \right\}.
\end{align}  Finally, we can expand the vorticity term and hence obtain
\begin{align} \label{eq:CovariantUpdateEquation}
\left( \pdiff{\vb{v}_h}{t} \right)_s =& - \nabla_s \left[ K - w \left( \pdiff{z}{t} \right)_s + \Phi \right] - \frac{1}{\rho} \nabla_s p - \left[ 2 \vg{\Omega} \times \vb{u} \right]_s \nonumber \\
& \qquad + \left[ \vb{k} \cdot \nabla_s \times \vb{v}_h \right] (\vb{u}_h \times \vb{k}) - \dot{s} \left\{ \pdiff{\vb{v}_h}{s} - \nabla_s \left[ \left( \pdiff{s}{z} \right)^{-1} w \right] \right\} - \left( \pdiff{z}{t} \right)_s \vb{u}_h \cdot \nabla \vb{k}.
\end{align}

\subsection{Vorticity-Divergence Form}

The vorticity-divergence form of the dynamical equations in an arbitrary vertical coordinate predicts the absolute vorticity ($\zeta_h^\ast$) and velocity divergence ($D$) given by
\begin{align} \label{eq:AbsoluteVorticityS}
\zeta_h^\ast = (\nabla_s \times \vb{u}_h + 2 \vg{\Omega}) \cdot \vb{k},
\end{align} and
\begin{align} \label{eq:DivergenceSx}
D \equiv \nabla_s \cdot \vb{u}_h,
\end{align} respectively, instead of the horizontal velocity.  The horizontal velocity can be obtained from the streamfunction $\psi$ and the velocity potential $\chi$ following
\begin{align} \label{eq:VelocityStreamfunctionPotentialRelationship}
\vb{u}_h = \vb{k} \times \nabla_s \psi + \nabla_s \chi.
\end{align}  By using (\ref{eq:VelocityStreamfunctionPotentialRelationship}) in (\ref{eq:AbsoluteVorticityS}) and (\ref{eq:DivergenceSx}), we obtain the elliptic equations that diagnose the streamfunction and velocity potential from the predicted velocity and divergence as
\begin{align} \label{eq:LaplacianStreamfunctionPotential}
\nabla_s^2 = \zeta_h^\ast - 2 \vg{\Omega} \cdot \vb{k}, \quad \mbox{and} \quad \nabla_s^2 \chi = D,
\end{align} respectively.

By taking the material derivative (\ref{eq:MaterialDerivativeS}) of (\ref{eq:AbsoluteVorticityS}) and using the horizontal momentum equation (\ref{eq:PrognosticUhEquationK2}), (\ref{eq:VelocityStreamfunctionPotentialRelationship}) and (\ref{eq:LaplacianStreamfunctionPotential}), the absolute vorticity prediction equation emerges,
\begin{align}
\left( \pdiff{\zeta_h^\ast}{t} \right)_s - J_s(\zeta_h^\ast, \psi) + \nabla_s \cdot (\zeta_h^\ast \nabla_s \chi) + \nabla_s \cdot \left( \dot{s} \pdiff{}{s} \nabla_s \psi \right) + \vb{k} \cdot \nabla_s \times \left( \dot{s} \pdiff{}{s} \nabla_s \chi \right) + J_s(\rho^{-1}, p) = 0,
\end{align} where $J_s(a,b) = \vb{k} \cdot \nabla_s \times (a \nabla_s b)$ is the Jacobian operator.  It can also be shown that $\dot{s}$ relates to the vertical velocity $w$ through
\begin{align}
\dot{s} = \left( \pdiff{s}{z} \right) (w - w_c),
\end{align} where
\begin{align}
w_c \equiv \left( \pdiff{z}{t} \right)_s + \left( \vb{k} \times \nabla_s \psi + \nabla_s \chi \right) \cdot (\nabla_s z).
\end{align}

By taking the material derivative of (\ref{eq:DivergenceSx}) and using (\ref{eq:PrognosticUhEquationK2}), (\ref{eq:VelocityStreamfunctionPotentialRelationship}) and (\ref{eq:LaplacianStreamfunctionPotential}), we can obtain the divergence prediction equation
\begin{align}
\left( \pdiff{D}{t} \right)_s - J_s(\zeta_h^\ast, \chi) - \nabla_s \cdot (\zeta_h^\ast \nabla_s \psi) + \nabla_s \cdot \left( \dot{s} \pdiff{}{s} \nabla_s \chi \right) + \left( \vb{k} \times \pdiff{}{s} \nabla_s \psi \right) \cdot \nabla_s \dot{s} & \\
+ \nabla_s \cdot (\nabla_s K_2 + g \nabla_s z) + \nabla_s \cdot \left( \frac{1}{\rho} \nabla_s p \right) &= 0,
\end{align}  where $K_2$ can be reformulated in terms of streamfunction and velocity potential as
\begin{align}
K_2 = \frac{1}{2} \left[ \nabla_s \cdot (\psi \nabla_s \psi) - \psi \nabla_s^2 \psi + \nabla_s \cdot (\chi \nabla_s \chi) - \chi \nabla_s^2 \chi \right] + J_s(\psi, \chi).
\end{align}

\subsection{Momentum Form}

The momentum form of the prognostic equations emerges by combining the prognostic velocity equations with a continuity equation.  Essentially any of the continuity equations can be chosen, as long as the mass field represented by the equation is everywhere non-zero.  However, the most common options are moist pseudo-density \citep{ullrich2012mcore} or dry pseudo-density \citep{skamarock2012multiscale}.  Here we denote our density variable by $\tilde{\rho}_s$, and assume no external sources or sinks of $\tilde{\rho}$.  Multiplying (\ref{eq:PrognosticWEquationK2Sb}) through by $\tilde{\rho}_s$ and using (\ref{eq:PrognosticPseudoDensity}) gives
\begin{align} \label{eq:PrognosticRhoWEquationK2Sb}
\left( \pdiff{\tilde{\rho}_s w}{t} \right)_s =& \tilde{\rho}_s \vb{u}_h \cdot (\vb{u}_h \cdot \nabla \vb{k}) - \nabla_s \cdot (\tilde{\rho}_s \vb{u}_h w) - \pdiff{}{s} (\tilde{\rho}_s \dot{s} w) + \tilde{\rho}_s \left( \pdiff{s}{z} \right) \left[ - \pdiff{\Phi}{s} - \frac{1}{\rho} \pdiff{p}{s} \right] - (2 \vg{\Omega} \times \tilde{\rho}_s \vb{u}_h) \cdot \vb{k}.
\end{align}  Similarly, from (\ref{eq:PrognosticUhEquationK2Sb}) we have
\begin{align} \label{eq:PrognosticRhoUhEquationK2Sb}
\left( \pdiff{\tilde{\rho}_s \vb{u}_h}{t} \right)_s =& - \tilde{\rho}_s w (\vb{u}_h \cdot \nabla \vb{k}) - \tilde{\rho}_s \nabla_s K_2 - \zeta_s \vb{k} \times \tilde{\rho}_s \vb{u}_h - \vb{u}_h \nabla_s \cdot (\tilde{\rho}_s \vb{u}_h) - \pdiff{}{s} (\tilde{\rho}_s \dot{s} \vb{u}_h) - \tilde{\rho}_s \left( \nabla_z \Phi + \frac{1}{\rho} \nabla_z p \right) - [2 \vg{\Omega} \times \tilde{\rho}_s \vb{u}]_z,
\end{align}





%\appendix
%\section{}    %% Appendix A

%\subsection{}                               %% Appendix A1, A2, etc.


\authorcontribution{TEXT}

\begin{acknowledgements}
DCMIP2016 is sponsored by the National Center for Atmospheric Research Computational Information Systems Laboratory, the Department of Energy Office of Science (award no. DE-SC0016015), the National Science Foundation (award no. 1629819), the National Aeronautics and Space Administration (award no. {\color{red}??}), the National Oceanic and Atmospheric Administration (award no. {\color{red}??}), the Office of Naval Research and CU Boulder Research Computing.  This work was made possible with support from our student and postdoctoral participants: Sabina Abba Omar, Scott Bachman, Amanda Back, Tobias Bauer, Vinicius Capistrano, Spencer Clark, Ross Dixon, Christopher Eldred, Robert Fajber, Jared Ferguson, Emily Foshee, Ariane Frassoni, Alexander Goldstein, Jorge Guerra, Chasity Henson, Adam Herrington, Tsung-Lin Hsieh, Dave Lee, Theodore Letcher, Weiwei Li, Laura Mazzaro, Maximo Menchaca, Jonathan Meyer, Farshid Nazari, John O'Brien, Bjarke Tobias Olsen, Hossein Parishani, Charles Pelletier, Thomas Rackow, Kabir Rasouli, Cameron Rencurrel, Koichi Sakaguchi, G\"okhan Sever, James Shaw, Konrad Simon, Abhishekh Srivastava, Nicholas Szapiro, Kazushi Takemura, Pushp Raj Tiwari, Chii-Yun Tsai, Richard Urata, Karin van der Wiel, Lei Wang, Eric Wolf, Zheng Wu, Haiyang Yu, Sungduk Yu and Jiawei Zhuang.  We would also like to thank Rich Loft, Cecilia Banner, Kathryn Peczkowicz and Rory Kelly (NCAR), Perla Dinger, Carmen Ho, and Gina Skyberg (UC Davis) and Kristi Hansen (University of Michigan) for administrative support during the workshop and summer school.  
\end{acknowledgements}



%% REFERENCES

%% Since the Copernicus LaTeX package includes the BibTeX style file copernicus.bst,
%% authors experienced with BibTeX only have to include the following two lines:
%%
\bibliographystyle{copernicus}
\bibliography{DCMIP2016-Part1.bib}
%%
%% URLs and DOIs can be entered in your BibTeX file as:
%%
%% URL = {http://www.xyz.org/~jones/idx_g.htm}
%% DOI = {10.5194/xyz}


%% LITERATURE CITATIONS
%%
%% command                        & example result
%% \citet{jones90}|               & Jones et al. (1990)
%% \citep{jones90}|               & (Jones et al., 1990)
%% \citep{jones90,jones93}|       & (Jones et al., 1990, 1993)
%% \citep[p.~32]{jones90}|        & (Jones et al., 1990, p.~32)
%% \citep[e.g.,][]{jones90}|      & (e.g., Jones et al., 1990)
%% \citep[e.g.,][p.~32]{jones90}| & (e.g., Jones et al., 1990, p.~32)
%% \citeauthor{jones90}|          & Jones et al.
%% \citeyear{jones90}|            & 1990



%% FIGURES

%% ONE-COLUMN FIGURES

%%f
%\begin{figure}[t]
%\includegraphics[width=8.3cm]{FILE NAME}
%\caption{TEXT}
%\end{figure}
%
%%% TWO-COLUMN FIGURES
%
%%f
%\begin{figure*}[t]
%\includegraphics[width=12cm]{FILE NAME}
%\caption{TEXT}
%\end{figure*}
%
%
%%% TABLES
%%%
%%% The different columns must be seperated with a & command and should
%%% end with \\ to identify the column brake.
%
%%% ONE-COLUMN TABLE
%
%%t
%\begin{table}[t]
%\caption{TEXT}
%\begin{tabular}{column = lcr}
%\tophline
%
%\middlehline
%
%\bottomhline
%\end{tabular}
%\belowtable{} % Table Footnotes
%\end{table}
%
%%% TWO-COLUMN TABLE
%
%%t
%\begin{table*}[t]
%\caption{TEXT}
%\begin{tabular}{column = lcr}
%\tophline
%
%\middlehline
%
%\bottomhline
%\end{tabular}
%\belowtable{} % Table Footnotes
%\end{table*}
%
%
%%% NUMBERING OF FIGURES AND TABLES
%%%
%%% If figures and tables must be numbered 1a, 1b, etc. the following command
%%% should be inserted before the begin{} command.
%
%\addtocounter{figure}{-1}\renewcommand{\thefigure}{\arabic{figure}a}
%
%
%%% MATHEMATICAL EXPRESSIONS
%
%%% All papers typeset by Copernicus Publications follow the math typesetting regulations
%%% given by the IUPAC Green Book (IUPAC: Quantities, Units and Symbols in Physical Chemistry,
%%% 2nd Edn., Blackwell Science, available at: http://old.iupac.org/publications/books/gbook/green_book_2ed.pdf, 1993).
%%%
%%% Physical quantities/variables are typeset in italic font (t for time, T for Temperature)
%%% Indices which are not defined are typeset in italic font (x, y, z, a, b, c)
%%% Items/objects which are defined are typeset in roman font (Car A, Car B)
%%% Descriptions/specifications which are defined by itself are typeset in roman font (abs, rel, ref, tot, net, ice)
%%% Abbreviations from 2 letters are typeset in roman font (RH, LAI)
%%% Vectors are identified in bold italic font using \vec{x}
%%% Matrices are identified in bold roman font
%%% Multiplication signs are typeset using the LaTeX commands \times (for vector products, grids, and exponential notations) or \cdot
%%% The character * should not be applied as mutliplication sign
%
%
%%% EQUATIONS
%
%%% Single-row equation
%
%\begin{equation}
%
%\end{equation}
%
%%% Multiline equation
%
%\begin{align}
%& 3 + 5 = 8\\
%& 3 + 5 = 8\\
%& 3 + 5 = 8
%\end{align}
%
%
%%% MATRICES
%
%\begin{matrix}
%x & y & z\\
%x & y & z\\
%x & y & z\\
%\end{matrix}
%
%
%%% ALGORITHM
%
%\begin{algorithm}
%\caption{}
%\label{a1}
%\begin{algorithmic}
%
%\end{algorithmic}
%\end{algorithm}
%
%
%%% CHEMICAL FORMULAS AND REACTIONS
%
%%% For formulas embedded in the text, please use \chem{}
%
%%% The reaction environment creates labels including the letter R, i.e. (R1), (R2), etc.
%
%\begin{reaction}
%%% \rightarrow should be used for normal (one-way) chemical reactions
%%% \rightleftharpoons should be used for equilibria
%%% \leftrightarrow should be used for resonance structures
%\end{reaction}
%
%
%%% PHYSICAL UNITS
%%%
%%% Please use \unit{} and apply the exponential notation


\end{document}
